
> my-v0-project@0.1.0 dev
> next dev

  ▲ Next.js 14.2.16
  - Local:        http://localhost:3000
  - Environments: .env.local
  - Experiments (use with caution):
    · webpackBuildWorker
    · parallelServerCompiles
    · parallelServerBuildTraces

 ✓ Starting...
 ✓ Ready in 1527ms
 ○ Compiling /middleware ...
 ✓ Compiled /middleware in 1304ms (256 modules)
 ○ Compiling / ...
 ✓ Compiled / in 4.7s (1876 modules)
 HEAD / 200 in 5116ms
 ✓ Compiled in 563ms (896 modules)
 GET / 200 in 50ms
 ○ Compiling /dashboard ...
 ✓ Compiled /dashboard in 1985ms (2545 modules)
 ✓ Compiled /api/chat-context in 247ms (1447 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 0173c848-172b-45f9-a157-1fe7c264b3d7
Fetching latest lab report...
Found lab report: 95b7321b-00f5-4219-b8a0-dac0364fd111 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T16:50:01.869Z] [ERROR] [chat-context] [09eb17ff-93d2-4304-85a8-e6367951ae94] Failed to fetch health score {
  requestId: '09eb17ff-93d2-4304-85a8-e6367951ae94',
  timestamp: '2025-02-28T16:50:01.869Z',
  userId: '0173c848-172b-45f9-a157-1fe7c264b3d7',
  route: 'chat-context',
  duration: 352,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
Found 5 previous reports
Fetching previous reports for historical context...
Found 3 previous reports
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T16:50:02.331Z] [INFO] [chat-context] [09eb17ff-93d2-4304-85a8-e6367951ae94] Successfully generated chat context {
  requestId: '09eb17ff-93d2-4304-85a8-e6367951ae94',
  timestamp: '2025-02-28T16:50:02.331Z',
  userId: '0173c848-172b-45f9-a157-1fe7c264b3d7',
  route: 'chat-context',
  duration: 814,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: '95b7321b-00f5-4219-b8a0-dac0364fd111',
    hasPreviousReports: true
  }
}
 GET /api/chat-context 200 in 1142ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 0173c848-172b-45f9-a157-1fe7c264b3d7
Fetching latest lab report...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=95b7321b-00f5-4219-b8a0-dac0364fd111
Requested report ID: 95b7321b-00f5-4219-b8a0-dac0364fd111
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 0173c848-172b-45f9-a157-1fe7c264b3d7
Fetching specified lab report...
Found lab report: 95b7321b-00f5-4219-b8a0-dac0364fd111 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found lab report: 95b7321b-00f5-4219-b8a0-dac0364fd111 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T16:50:02.771Z] [ERROR] [chat-context] [d9eb09a2-a6bf-4b2b-840d-433d8d881578] Failed to fetch health score {
  requestId: 'd9eb09a2-a6bf-4b2b-840d-433d8d881578',
  timestamp: '2025-02-28T16:50:02.771Z',
  userId: '0173c848-172b-45f9-a157-1fe7c264b3d7',
  route: 'chat-context',
  duration: 419,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T16:50:02.775Z] [ERROR] [chat-context] [aba926cb-6e52-4e6c-9ec0-1d88305b716f] Failed to fetch health score {
  requestId: 'aba926cb-6e52-4e6c-9ec0-1d88305b716f',
  timestamp: '2025-02-28T16:50:02.775Z',
  userId: '0173c848-172b-45f9-a157-1fe7c264b3d7',
  route: 'chat-context',
  duration: 328,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
Found 5 previous reports
Fetching previous reports for historical context...
Found 5 previous reports
Fetching previous reports for historical context...
Found 3 previous reports
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T16:50:02.928Z] [INFO] [chat-context] [aba926cb-6e52-4e6c-9ec0-1d88305b716f] Successfully generated chat context {
  requestId: 'aba926cb-6e52-4e6c-9ec0-1d88305b716f',
  timestamp: '2025-02-28T16:50:02.928Z',
  userId: '0173c848-172b-45f9-a157-1fe7c264b3d7',
  route: 'chat-context',
  duration: 481,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: '95b7321b-00f5-4219-b8a0-dac0364fd111',
    hasPreviousReports: true
  }
}
 GET /api/chat-context?report_id=95b7321b-00f5-4219-b8a0-dac0364fd111 200 in 486ms
Found 3 previous reports
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T16:50:02.951Z] [INFO] [chat-context] [d9eb09a2-a6bf-4b2b-840d-433d8d881578] Successfully generated chat context {
  requestId: 'd9eb09a2-a6bf-4b2b-840d-433d8d881578',
  timestamp: '2025-02-28T16:50:02.951Z',
  userId: '0173c848-172b-45f9-a157-1fe7c264b3d7',
  route: 'chat-context',
  duration: 599,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: '95b7321b-00f5-4219-b8a0-dac0364fd111',
    hasPreviousReports: true
  }
}
 GET /api/chat-context 200 in 618ms
 ○ Compiling /dashboard/labs ...
 ✓ Compiled /dashboard/labs in 576ms (2664 modules)
 ○ Compiling /auth ...
 ✓ Compiled /auth in 581ms (2690 modules)
 GET /auth 200 in 1462ms
 ✓ Compiled /api/auth/register in 243ms (1507 modules)
Profile creation error: {
  code: '42501',
  details: null,
  hint: null,
  message: 'new row violates row-level security policy for table "profiles"'
}
 POST /api/auth/register 200 in 1965ms
 GET /auth?redirectedFrom=%2Fdashboard 200 in 97ms
 GET /?code=ac496af8-a539-4298-b6fa-32dcdbca21df 200 in 158ms
 GET /dashboard 200 in 372ms
 ✓ Compiled /api/chat-context in 275ms (1510 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
No lab reports found for user
 GET /api/chat-context 200 in 439ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
No lab reports found for user
 GET /api/chat-context 200 in 80ms
 ○ Compiling /dashboard/reports ...
 ✓ Compiled /dashboard/reports in 633ms (2700 modules)
 ✓ Compiled /dashboard/upload-labs in 459ms (2708 modules)
 ○ Compiling /api/analyze-new ...
 ✓ Compiled /api/analyze-new in 2.2s (1838 modules)
POST request received to /api/analyze-new
Request URL: http://localhost:3000/api/analyze-new
Generated report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Created server-side Supabase client
Request content type: multipart/form-data; boundary=----WebKitFormBoundaryZ5eKCJhsACZqESIi
Parsed form data keys: [ 'userId', 'file' ]
File received: {
  name: 'malla_foundational_health_test.pdf',
  type: 'application/pdf',
  size: 54105
}
User ID: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Table check successful, table exists
Table columns: []
No rows returned - likely due to RLS. Checking schema differently.
Schema check error: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.information_schema.columns" does not exist'
}
All schema checks failed. Using default column assumptions to allow upload.
Using assumed columns: [
  'id',            'user_id',
  'status',        'report_date',
  'test_date',     'lab_name',
  'provider_name', 'notes',
  'file_path',     'pdf_url',
  'created_at',    'updated_at'
]
Attempting to insert lab report with ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 and user ID: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Uploading file to Supabase Storage with path: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6.pdf
File uploaded successfully: {
  path: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6.pdf',
  id: 'e538519c-b8f3-4bf4-b3a8-e6afa2d5f613',
  fullPath: 'labs/7a818aa4-a2dc-4693-82e0-16d1bef7a1f1/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6.pdf'
}
Generated public URL for file: https://renqczffpovkvkelvjvv.supabase.co/storage/v1/object/public/labs/7a818aa4-a2dc-4693-82e0-16d1bef7a1f1/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6.pdf
Inserting lab report with data: {
  id: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
  user_id: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  status: 'processing',
  report_date: '2025-02-28T16:52:32.309Z',
  test_date: '2025-02-28T16:52:32.309Z',
  lab_name: 'Uploaded Lab',
  provider_name: 'Self Upload',
  pdf_url: 'https://renqczffpovkvkelvjvv.supabase.co/storage/v1/object/public/labs/7a818aa4-a2dc-4693-82e0-16d1bef7a1f1/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6.pdf',
  file_path: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6.pdf'
}
Running insert into lab_reports with fields: id, user_id, status, report_date, test_date, lab_name, provider_name, pdf_url, file_path
Lab report created successfully: [
  {
    id: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    user_id: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
    report_date: '2025-02-28',
    lab_name: 'Uploaded Lab',
    provider_name: 'Self Upload',
    notes: null,
    pdf_url: 'https://renqczffpovkvkelvjvv.supabase.co/storage/v1/object/public/labs/7a818aa4-a2dc-4693-82e0-16d1bef7a1f1/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6.pdf',
    file_path: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6.pdf',
    status: 'processing',
    created_at: '2025-02-28T16:52:32.682089+00:00',
    updated_at: '2025-02-28T16:52:32.682089+00:00',
    test_date: '2025-02-28T16:52:32.309+00:00'
  }
]
Extracting biomarkers from PDF for report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Extracting text from PDF
Error during PDF extraction and analysis: Error: ENOENT: no such file or directory, open './test/data/05-versions-space.pdf'
    at Object.openSync (node:fs:581:18)
    at Object.readFileSync (node:fs:457:35)
    at eval (webpack-internal:///(rsc)/./node_modules/pdf-parse/index.js:16:25)
    at (rsc)/./node_modules/pdf-parse/index.js (/Users/samwilhoit/Documents/webdev/runehealth/.next/server/vendor-chunks/pdf-parse.js:19:1)
    at __webpack_require__ (/Users/samwilhoit/Documents/webdev/runehealth/.next/server/webpack-runtime.js:33:43)
    at eval (webpack-internal:///(rsc)/./lib/pdf-extraction.ts:9:67)
    at (rsc)/./lib/pdf-extraction.ts (/Users/samwilhoit/Documents/webdev/runehealth/.next/server/_rsc_node_modules_pdf-parse_lib_pdf_js_sync_recursive_build_pdf_js_-_rsc_lib_pdf-extraction_ts.js:66:1)
    at Function.__webpack_require__ (/Users/samwilhoit/Documents/webdev/runehealth/.next/server/webpack-runtime.js:33:43)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async POST (webpack-internal:///(rsc)/./app/api/analyze-new/route.ts:336:72)
    at async /Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:6:55831
    at async eO.execute (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:6:46527)
    at async eO.handle (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:6:57165)
    at async doRender (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/base-server.js:1352:42)
    at async cacheEntry.responseCache.get.routeKind (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/base-server.js:1574:28)
    at async DevServer.renderToResponseWithComponentsImpl (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/base-server.js:1482:28)
    at async DevServer.renderPageComponent (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/base-server.js:1908:24)
    at async DevServer.renderToResponseImpl (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/base-server.js:1946:32)
    at async DevServer.pipeImpl (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/base-server.js:921:25)
    at async NextNodeServer.handleCatchallRenderRequest (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/next-server.js:272:17)
    at async DevServer.handleRequestImpl (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/base-server.js:817:17)
    at async /Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/dev/next-dev-server.js:339:20
    at async Span.traceAsyncFn (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/trace/trace.js:154:20)
    at async DevServer.handleRequest (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/dev/next-dev-server.js:336:24)
    at async invokeRender (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/lib/router-server.js:173:21)
    at async handleRequest (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/lib/router-server.js:350:24)
    at async requestHandlerImpl (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/lib/router-server.js:374:13)
    at async Server.requestListener (/Users/samwilhoit/Documents/webdev/runehealth/node_modules/next/dist/server/lib/start-server.js:141:13) {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: './test/data/05-versions-space.pdf'
}
Falling back to sample biomarkers
Inserting 12 sample biomarkers as fallback
Successfully inserted 12 sample biomarkers
Successfully updated report b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 status to completed
Found 12 biomarkers (4 abnormal) for report b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6. Health score: 7
 POST /api/analyze-new 200 in 4081ms
 ○ Compiling /dashboard/labs/[id] ...
 ✓ Compiled /dashboard/labs/[id] in 1220ms (3062 modules)
 ○ Compiling /api/chat ...
 ✓ Compiled /api/chat in 577ms (466 modules)

=== CHAT API CONFIGURATION ===
NODE_ENV: development
OpenAI API key is present: sk-...tgcA (164 chars)
================================


=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "129"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T16:52:50.396Z] [DEBUG] [api/chat] [2e7bbeb7-9aa5-4b07-9d58-2c59eb1eacab] Starting operation: chat-completion {
  requestId: '2e7bbeb7-9aa5-4b07-9d58-2c59eb1eacab',
  timestamp: '2025-02-28T16:52:50.396Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: ubpup0fy
Attempting to parse request body...
Request body successfully parsed
Messages received: 1
[2025-02-28T16:52:50.398Z] [DEBUG] [api/chat] [2e7bbeb7-9aa5-4b07-9d58-2c59eb1eacab] Processing chat request {
  requestId: '2e7bbeb7-9aa5-4b07-9d58-2c59eb1eacab',
  timestamp: '2025-02-28T16:52:50.398Z',
  userId: undefined,
  route: 'api/chat',
  duration: 2,
  metadata: {
  messageCount: 1,
  lastMessage: {
  role: 'user',
  content: 'hello',
  parts: [ { type: 'text', text: 'hello' } ]
}
}
}
Last message (5 chars): "hello..."
Report ID specified in request: none (will use latest)
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T16:52:50.935Z] [ERROR] [chat-context] [c6bcc770-5d25-47f4-bdb0-474e0fecbc19] Failed to fetch health score {
  requestId: 'c6bcc770-5d25-47f4-bdb0-474e0fecbc19',
  timestamp: '2025-02-28T16:52:50.935Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 484,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T16:52:51.076Z] [INFO] [chat-context] [c6bcc770-5d25-47f4-bdb0-474e0fecbc19] Successfully generated chat context {
  requestId: 'c6bcc770-5d25-47f4-bdb0-474e0fecbc19',
  timestamp: '2025-02-28T16:52:51.076Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 625,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 674ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 1
Stream initialized in 471ms
[2025-02-28T16:52:51.553Z] [INFO] [api/chat] [2e7bbeb7-9aa5-4b07-9d58-2c59eb1eacab] Completed operation: chat-completion {
  requestId: '2e7bbeb7-9aa5-4b07-9d58-2c59eb1eacab',
  timestamp: '2025-02-28T16:52:51.553Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1157,
  metadata: { status: 'success', duration: 1157, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 2869ms

=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "430"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T16:52:59.549Z] [DEBUG] [api/chat] [4b326f10-e5f2-452d-b462-b897847e39ff] Starting operation: chat-completion {
  requestId: '4b326f10-e5f2-452d-b462-b897847e39ff',
  timestamp: '2025-02-28T16:52:59.549Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: kqrrf9l5
Attempting to parse request body...
Request body successfully parsed
Messages received: 3
[2025-02-28T16:52:59.550Z] [DEBUG] [api/chat] [4b326f10-e5f2-452d-b462-b897847e39ff] Processing chat request {
  requestId: '4b326f10-e5f2-452d-b462-b897847e39ff',
  timestamp: '2025-02-28T16:52:59.550Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1,
  metadata: {
  messageCount: 3,
  lastMessage: {
  role: 'user',
  content: 'tell me about my labs ',
  parts: [ { type: 'text', text: 'tell me about my labs ' } ]
}
}
}
Last message (22 chars): "tell me about my labs ..."
Report ID specified in request: none (will use latest)
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T16:52:59.885Z] [ERROR] [chat-context] [3a4624f9-574f-4598-acff-1aa4a42db13d] Failed to fetch health score {
  requestId: '3a4624f9-574f-4598-acff-1aa4a42db13d',
  timestamp: '2025-02-28T16:52:59.885Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 325,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T16:53:00.013Z] [INFO] [chat-context] [3a4624f9-574f-4598-acff-1aa4a42db13d] Successfully generated chat context {
  requestId: '3a4624f9-574f-4598-acff-1aa4a42db13d',
  timestamp: '2025-02-28T16:53:00.013Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 453,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 461ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 3
Stream initialized in 525ms
[2025-02-28T16:53:00.540Z] [INFO] [api/chat] [4b326f10-e5f2-452d-b462-b897847e39ff] Completed operation: chat-completion {
  requestId: '4b326f10-e5f2-452d-b462-b897847e39ff',
  timestamp: '2025-02-28T16:53:00.540Z',
  userId: undefined,
  route: 'api/chat',
  duration: 991,
  metadata: { status: 'success', duration: 991, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 17597ms
 ✓ Compiled in 1496ms (2659 modules)
 ✓ Compiled in 870ms (2901 modules)
 ✓ Compiled in 175ms (1213 modules)
 ✓ Compiled in 233ms (1213 modules)
 ✓ Compiled in 285ms (1213 modules)
 ✓ Compiled in 210ms (1213 modules)
 ○ Compiling /dashboard/health-survey ...
 ✓ Compiled /dashboard/health-survey in 1865ms (2701 modules)
 ✓ Compiled in 857ms (1217 modules)
 ✓ Compiled in 150ms (1217 modules)
 ✓ Compiled in 661ms (2711 modules)
 GET /dashboard/health-survey 200 in 295ms
 ✓ Compiled /api/chat-context in 488ms (1523 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/health-survey"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:04:44.173Z] [ERROR] [chat-context] [da4e7345-40d1-47d2-a6cc-b1f409f39b05] Failed to fetch health score {
  requestId: 'da4e7345-40d1-47d2-a6cc-b1f409f39b05',
  timestamp: '2025-02-28T17:04:44.173Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 449,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:04:44.333Z] [INFO] [chat-context] [da4e7345-40d1-47d2-a6cc-b1f409f39b05] Successfully generated chat context {
  requestId: 'da4e7345-40d1-47d2-a6cc-b1f409f39b05',
  timestamp: '2025-02-28T17:04:44.333Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 609,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 1205ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/health-survey"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/health-survey"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:04:44.652Z] [ERROR] [chat-context] [a6362b4a-21c5-4ec9-ae82-ee2929a23b35] Failed to fetch health score {
  requestId: 'a6362b4a-21c5-4ec9-ae82-ee2929a23b35',
  timestamp: '2025-02-28T17:04:44.652Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 306,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
Found 12 biomarkers
Fetching insights...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:04:44.813Z] [INFO] [chat-context] [a6362b4a-21c5-4ec9-ae82-ee2929a23b35] Successfully generated chat context {
  requestId: 'a6362b4a-21c5-4ec9-ae82-ee2929a23b35',
  timestamp: '2025-02-28T17:04:44.813Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 467,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 478ms
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:04:44.879Z] [ERROR] [chat-context] [c95ce796-60e2-4548-bf36-81ca2476768d] Failed to fetch health score {
  requestId: 'c95ce796-60e2-4548-bf36-81ca2476768d',
  timestamp: '2025-02-28T17:04:44.879Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 414,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:04:45.019Z] [INFO] [chat-context] [c95ce796-60e2-4548-bf36-81ca2476768d] Successfully generated chat context {
  requestId: 'c95ce796-60e2-4548-bf36-81ca2476768d',
  timestamp: '2025-02-28T17:04:45.019Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 554,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 560ms
 ○ Compiling /dashboard/reports ...
 ✓ Compiled /dashboard/reports in 1192ms (2735 modules)
 GET /dashboard/reports?survey=5312ecbf-2401-42c4-bd85-7fc1d48830e5 200 in 1427ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=5312ecbf-2401-42c4-bd85-7fc1d48830e5"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:05:14.405Z] [ERROR] [chat-context] [4beeaf72-72a6-4a28-ba00-ab2f52f093e4] Failed to fetch health score {
  requestId: '4beeaf72-72a6-4a28-ba00-ab2f52f093e4',
  timestamp: '2025-02-28T17:05:14.405Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 403,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:05:14.537Z] [INFO] [chat-context] [4beeaf72-72a6-4a28-ba00-ab2f52f093e4] Successfully generated chat context {
  requestId: '4beeaf72-72a6-4a28-ba00-ab2f52f093e4',
  timestamp: '2025-02-28T17:05:14.537Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 535,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 558ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=5312ecbf-2401-42c4-bd85-7fc1d48830e5"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=5312ecbf-2401-42c4-bd85-7fc1d48830e5"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 0 insights
Fetching health score...
Found 12 biomarkers
Fetching insights...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:05:14.893Z] [ERROR] [chat-context] [3cede9f0-4aa9-4622-a993-52c9a7b76b20] Failed to fetch health score {
  requestId: '3cede9f0-4aa9-4622-a993-52c9a7b76b20',
  timestamp: '2025-02-28T17:05:14.893Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 339,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
Found 0 insights
Fetching health score...
No previous reports found
Fetching previous reports for historical context...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:05:15.029Z] [ERROR] [chat-context] [7394873b-d5e5-4443-95c5-6a102154d4da] Failed to fetch health score {
  requestId: '7394873b-d5e5-4443-95c5-6a102154d4da',
  timestamp: '2025-02-28T17:05:15.029Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 356,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:05:15.045Z] [INFO] [chat-context] [3cede9f0-4aa9-4622-a993-52c9a7b76b20] Successfully generated chat context {
  requestId: '3cede9f0-4aa9-4622-a993-52c9a7b76b20',
  timestamp: '2025-02-28T17:05:15.045Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 491,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 502ms
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:05:15.172Z] [INFO] [chat-context] [7394873b-d5e5-4443-95c5-6a102154d4da] Successfully generated chat context {
  requestId: '7394873b-d5e5-4443-95c5-6a102154d4da',
  timestamp: '2025-02-28T17:05:15.172Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 499,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 511ms
 ✓ Compiled in 955ms (2675 modules)
 ✓ Compiled in 491ms (2675 modules)
 ✓ Compiled in 777ms (2675 modules)
 ✓ Compiled in 211ms (1220 modules)
 ✓ Compiled in 209ms (1220 modules)
 ○ Compiling /dashboard ...
 ✓ Compiled /dashboard in 816ms (1459 modules)
 GET /dashboard/reports?survey=5312ecbf-2401-42c4-bd85-7fc1d48830e5 200 in 410ms
 ○ Compiling /api/chat-context ...
 ✓ Compiled /api/chat-context in 505ms (1473 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=5312ecbf-2401-42c4-bd85-7fc1d48830e5"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:12:39.518Z] [ERROR] [chat-context] [0d626910-57e3-4e7f-baa0-3eca325e1c66] Failed to fetch health score {
  requestId: '0d626910-57e3-4e7f-baa0-3eca325e1c66',
  timestamp: '2025-02-28T17:12:39.518Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 363,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:12:39.680Z] [INFO] [chat-context] [0d626910-57e3-4e7f-baa0-3eca325e1c66] Successfully generated chat context {
  requestId: '0d626910-57e3-4e7f-baa0-3eca325e1c66',
  timestamp: '2025-02-28T17:12:39.680Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 525,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 1106ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=5312ecbf-2401-42c4-bd85-7fc1d48830e5"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=5312ecbf-2401-42c4-bd85-7fc1d48830e5"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:12:39.964Z] [ERROR] [chat-context] [d3620c1e-84ba-47b8-9d0c-9d623c9b4fe3] Failed to fetch health score {
  requestId: 'd3620c1e-84ba-47b8-9d0c-9d623c9b4fe3',
  timestamp: '2025-02-28T17:12:39.964Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 268,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
No previous reports found
Fetching previous reports for historical context...
Found 12 biomarkers
Fetching insights...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:12:40.125Z] [INFO] [chat-context] [d3620c1e-84ba-47b8-9d0c-9d623c9b4fe3] Successfully generated chat context {
  requestId: 'd3620c1e-84ba-47b8-9d0c-9d623c9b4fe3',
  timestamp: '2025-02-28T17:12:40.125Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 429,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 443ms
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:12:40.245Z] [ERROR] [chat-context] [79d8184d-232b-4176-9306-903b30c14c42] Failed to fetch health score {
  requestId: '79d8184d-232b-4176-9306-903b30c14c42',
  timestamp: '2025-02-28T17:12:40.245Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 429,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:12:40.372Z] [INFO] [chat-context] [79d8184d-232b-4176-9306-903b30c14c42] Successfully generated chat context {
  requestId: '79d8184d-232b-4176-9306-903b30c14c42',
  timestamp: '2025-02-28T17:12:40.372Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 556,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 565ms
 ○ Compiling /api/generate-recommendations ...
 ✓ Compiled /api/generate-recommendations in 3.4s (2821 modules)
Received POST request to /api/generate-recommendations
Received survey data: {
  "name": "sam",
  "age": "32",
  "gender": "male",
  "heightFeet": "",
  "heightInches": "",
  "weight": "",
  "symptoms": [
    "Weight changes",
    "Muscle weakness",
    "Joint pain"
  ],
  "healthGoals": [
    "Enhance mental clarity",
    "Improve skin health",
    "Balance hormones"
  ],
  "dietaryHabits": [
    "Paleo"
  ],
  "sleepQuality": 2,
  "stressLevel": 9,
  "exerciseFrequency": 3,
  "waterIntake": 5,
  "height": ""
}
Sending request to OpenAI
 POST /api/generate-recommendations 200 in 18638ms
 GET /dashboard/reports?survey=3b7fc348-af30-47e0-8293-2291cdf236d9 200 in 231ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=3b7fc348-af30-47e0-8293-2291cdf236d9"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:13:29.578Z] [ERROR] [chat-context] [fb331260-9f04-481d-85a2-ecf6ccffb776] Failed to fetch health score {
  requestId: 'fb331260-9f04-481d-85a2-ecf6ccffb776',
  timestamp: '2025-02-28T17:13:29.578Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 351,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:13:29.718Z] [INFO] [chat-context] [fb331260-9f04-481d-85a2-ecf6ccffb776] Successfully generated chat context {
  requestId: 'fb331260-9f04-481d-85a2-ecf6ccffb776',
  timestamp: '2025-02-28T17:13:29.718Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 491,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 507ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=3b7fc348-af30-47e0-8293-2291cdf236d9"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=3b7fc348-af30-47e0-8293-2291cdf236d9"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:13:30.020Z] [ERROR] [chat-context] [d9fb6947-c248-420b-aa71-a5ff524fcc56] Failed to fetch health score {
  requestId: 'd9fb6947-c248-420b-aa71-a5ff524fcc56',
  timestamp: '2025-02-28T17:13:30.020Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 287,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
Found 12 biomarkers
Fetching insights...
No previous reports found
Fetching previous reports for historical context...
Found 0 insights
Fetching health score...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:13:30.151Z] [INFO] [chat-context] [d9fb6947-c248-420b-aa71-a5ff524fcc56] Successfully generated chat context {
  requestId: 'd9fb6947-c248-420b-aa71-a5ff524fcc56',
  timestamp: '2025-02-28T17:13:30.151Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 418,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 433ms
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:13:30.156Z] [ERROR] [chat-context] [9ccacb3d-4c74-4b36-b81f-30c89f3fffac] Failed to fetch health score {
  requestId: '9ccacb3d-4c74-4b36-b81f-30c89f3fffac',
  timestamp: '2025-02-28T17:13:30.156Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 341,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:13:30.303Z] [INFO] [chat-context] [9ccacb3d-4c74-4b36-b81f-30c89f3fffac] Successfully generated chat context {
  requestId: '9ccacb3d-4c74-4b36-b81f-30c89f3fffac',
  timestamp: '2025-02-28T17:13:30.303Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 488,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 497ms
 ✓ Compiled in 1416ms (2815 modules)
 ✓ Compiled in 1306ms (2672 modules)
 GET /dashboard/reports?survey=3b7fc348-af30-47e0-8293-2291cdf236d9 200 in 371ms
 ✓ Compiled /api/chat-context in 216ms (1477 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=3b7fc348-af30-47e0-8293-2291cdf236d9"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:16:53.076Z] [ERROR] [chat-context] [549906d3-99e5-4374-a83e-1937b3459a36] Failed to fetch health score {
  requestId: '549906d3-99e5-4374-a83e-1937b3459a36',
  timestamp: '2025-02-28T17:16:53.076Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 393,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:16:53.223Z] [INFO] [chat-context] [549906d3-99e5-4374-a83e-1937b3459a36] Successfully generated chat context {
  requestId: '549906d3-99e5-4374-a83e-1937b3459a36',
  timestamp: '2025-02-28T17:16:53.223Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 540,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 862ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=3b7fc348-af30-47e0-8293-2291cdf236d9"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/reports?survey=3b7fc348-af30-47e0-8293-2291cdf236d9"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:16:53.589Z] [ERROR] [chat-context] [6046b5c9-d023-49fa-b868-2743af9983c4] Failed to fetch health score {
  requestId: '6046b5c9-d023-49fa-b868-2743af9983c4',
  timestamp: '2025-02-28T17:16:53.589Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 337,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
No previous reports found
Fetching previous reports for historical context...
Found 12 biomarkers
Fetching insights...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:16:53.753Z] [INFO] [chat-context] [6046b5c9-d023-49fa-b868-2743af9983c4] Successfully generated chat context {
  requestId: '6046b5c9-d023-49fa-b868-2743af9983c4',
  timestamp: '2025-02-28T17:16:53.753Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 501,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 510ms
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:16:53.893Z] [ERROR] [chat-context] [8b2747f5-7261-4876-9695-cf8c26552924] Failed to fetch health score {
  requestId: '8b2747f5-7261-4876-9695-cf8c26552924',
  timestamp: '2025-02-28T17:16:53.893Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 417,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:16:54.041Z] [INFO] [chat-context] [8b2747f5-7261-4876-9695-cf8c26552924] Successfully generated chat context {
  requestId: '8b2747f5-7261-4876-9695-cf8c26552924',
  timestamp: '2025-02-28T17:16:54.041Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 565,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 571ms
 ○ Compiling /dashboard/plan ...
 ✓ Compiled /dashboard/plan in 983ms (2662 modules)
 ✓ Compiled in 677ms (1224 modules)
 ✓ Compiled in 283ms (1224 modules)
 ✓ Compiled in 1665ms (2664 modules)
 ✓ Compiled /api/chat-context in 368ms (1469 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:20:18.686Z] [ERROR] [chat-context] [bb80e378-4a4a-4671-8766-189d6074bd77] Failed to fetch health score {
  requestId: 'bb80e378-4a4a-4671-8766-189d6074bd77',
  timestamp: '2025-02-28T17:20:18.686Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 446,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:20:18.793Z] [INFO] [chat-context] [bb80e378-4a4a-4671-8766-189d6074bd77] Added survey data to chat context {
  requestId: 'bb80e378-4a4a-4671-8766-189d6074bd77',
  timestamp: '2025-02-28T17:20:18.793Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 553,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:20:18.981Z] [INFO] [chat-context] [bb80e378-4a4a-4671-8766-189d6074bd77] Successfully generated chat context {
  requestId: 'bb80e378-4a4a-4671-8766-189d6074bd77',
  timestamp: '2025-02-28T17:20:18.981Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 741,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 1197ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 0 insights
Fetching health score...
Found 12 biomarkers
Fetching insights...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:20:19.382Z] [ERROR] [chat-context] [3ab5147e-fc59-4f6c-9e4b-cb0ca14e920e] Failed to fetch health score {
  requestId: '3ab5147e-fc59-4f6c-9e4b-cb0ca14e920e',
  timestamp: '2025-02-28T17:20:19.382Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 391,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found 0 insights
Fetching health score...
Found health survey data from: 2/28/2025
[2025-02-28T17:20:19.452Z] [INFO] [chat-context] [3ab5147e-fc59-4f6c-9e4b-cb0ca14e920e] Added survey data to chat context {
  requestId: '3ab5147e-fc59-4f6c-9e4b-cb0ca14e920e',
  timestamp: '2025-02-28T17:20:19.452Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 461,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:20:19.538Z] [ERROR] [chat-context] [ec7bd937-0f36-4092-ba43-6511ce6a2feb] Failed to fetch health score {
  requestId: 'ec7bd937-0f36-4092-ba43-6511ce6a2feb',
  timestamp: '2025-02-28T17:20:19.538Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 408,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:20:19.583Z] [INFO] [chat-context] [3ab5147e-fc59-4f6c-9e4b-cb0ca14e920e] Successfully generated chat context {
  requestId: '3ab5147e-fc59-4f6c-9e4b-cb0ca14e920e',
  timestamp: '2025-02-28T17:20:19.583Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 592,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 600ms
Found health survey data from: 2/28/2025
[2025-02-28T17:20:19.623Z] [INFO] [chat-context] [ec7bd937-0f36-4092-ba43-6511ce6a2feb] Added survey data to chat context {
  requestId: 'ec7bd937-0f36-4092-ba43-6511ce6a2feb',
  timestamp: '2025-02-28T17:20:19.623Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 493,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:20:19.764Z] [INFO] [chat-context] [ec7bd937-0f36-4092-ba43-6511ce6a2feb] Successfully generated chat context {
  requestId: 'ec7bd937-0f36-4092-ba43-6511ce6a2feb',
  timestamp: '2025-02-28T17:20:19.764Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 634,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 644ms
 ✓ Compiled in 475ms (2693 modules)
 ✓ Compiled in 679ms (1224 modules)
 ✓ Compiled /api/chat in 298ms (466 modules)

=== CHAT API CONFIGURATION ===
NODE_ENV: development
OpenAI API key is present: sk-...tgcA (164 chars)
================================


=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "157"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:25:17.406Z] [DEBUG] [api/chat] [aed89f03-923f-4815-aa56-d4f3d7cea8df] Starting operation: chat-completion {
  requestId: 'aed89f03-923f-4815-aa56-d4f3d7cea8df',
  timestamp: '2025-02-28T17:25:17.406Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: 4ywqs51r
Attempting to parse request body...
Request body successfully parsed
Messages received: 1
[2025-02-28T17:25:17.412Z] [DEBUG] [api/chat] [aed89f03-923f-4815-aa56-d4f3d7cea8df] Processing chat request {
  requestId: 'aed89f03-923f-4815-aa56-d4f3d7cea8df',
  timestamp: '2025-02-28T17:25:17.412Z',
  userId: undefined,
  route: 'api/chat',
  duration: 6,
  metadata: {
  messageCount: 1,
  lastMessage: {
  role: 'user',
  content: 'hi',
  parts: [ { type: 'text', text: 'hi' } ]
}
}
}
Last message (2 chars): "hi..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:25:18.116Z] [ERROR] [chat-context] [e2510c1e-f964-45a4-8fdd-907b181c653d] Failed to fetch health score {
  requestId: 'e2510c1e-f964-45a4-8fdd-907b181c653d',
  timestamp: '2025-02-28T17:25:18.116Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 560,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:25:18.213Z] [INFO] [chat-context] [e2510c1e-f964-45a4-8fdd-907b181c653d] Added survey data to chat context {
  requestId: 'e2510c1e-f964-45a4-8fdd-907b181c653d',
  timestamp: '2025-02-28T17:25:18.213Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 657,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:25:18.386Z] [INFO] [chat-context] [e2510c1e-f964-45a4-8fdd-907b181c653d] Successfully generated chat context {
  requestId: 'e2510c1e-f964-45a4-8fdd-907b181c653d',
  timestamp: '2025-02-28T17:25:18.386Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 830,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 954ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:25:18.390Z] [INFO] [api/chat] [aed89f03-923f-4815-aa56-d4f3d7cea8df] Survey data available for chat {
  requestId: 'aed89f03-923f-4815-aa56-d4f3d7cea8df',
  timestamp: '2025-02-28T17:25:18.390Z',
  userId: undefined,
  route: 'api/chat',
  duration: 984,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 1
Stream initialized in 724ms
[2025-02-28T17:25:19.114Z] [INFO] [api/chat] [aed89f03-923f-4815-aa56-d4f3d7cea8df] Completed operation: chat-completion {
  requestId: 'aed89f03-923f-4815-aa56-d4f3d7cea8df',
  timestamp: '2025-02-28T17:25:19.114Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1708,
  metadata: { status: 'success', duration: 1708, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 3668ms

=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "518"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:25:35.944Z] [DEBUG] [api/chat] [4b31a500-da3d-4e48-8ee8-f59c85f0bead] Starting operation: chat-completion {
  requestId: '4b31a500-da3d-4e48-8ee8-f59c85f0bead',
  timestamp: '2025-02-28T17:25:35.944Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: ya5v73rl
Attempting to parse request body...
Request body successfully parsed
Messages received: 3
[2025-02-28T17:25:35.945Z] [DEBUG] [api/chat] [4b31a500-da3d-4e48-8ee8-f59c85f0bead] Processing chat request {
  requestId: '4b31a500-da3d-4e48-8ee8-f59c85f0bead',
  timestamp: '2025-02-28T17:25:35.945Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1,
  metadata: {
  messageCount: 3,
  lastMessage: {
  role: 'user',
  content: 'taking into consideration my data, what do you know about me? ',
  parts: [
  {
  type: 'text',
  text: 'taking into consideration my data, what do you know about me? '
}
]
}
}
}
Last message (62 chars): "taking into consideration my data, what do you kno..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:25:36.290Z] [ERROR] [chat-context] [498ac87b-1d02-41e9-9458-89c2c5f7764f] Failed to fetch health score {
  requestId: '498ac87b-1d02-41e9-9458-89c2c5f7764f',
  timestamp: '2025-02-28T17:25:36.290Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 329,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:25:36.393Z] [INFO] [chat-context] [498ac87b-1d02-41e9-9458-89c2c5f7764f] Added survey data to chat context {
  requestId: '498ac87b-1d02-41e9-9458-89c2c5f7764f',
  timestamp: '2025-02-28T17:25:36.393Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 432,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:25:36.574Z] [INFO] [chat-context] [498ac87b-1d02-41e9-9458-89c2c5f7764f] Successfully generated chat context {
  requestId: '498ac87b-1d02-41e9-9458-89c2c5f7764f',
  timestamp: '2025-02-28T17:25:36.574Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 613,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 629ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:25:36.582Z] [INFO] [api/chat] [4b31a500-da3d-4e48-8ee8-f59c85f0bead] Survey data available for chat {
  requestId: '4b31a500-da3d-4e48-8ee8-f59c85f0bead',
  timestamp: '2025-02-28T17:25:36.582Z',
  userId: undefined,
  route: 'api/chat',
  duration: 638,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 3
Stream initialized in 553ms
[2025-02-28T17:25:37.135Z] [INFO] [api/chat] [4b31a500-da3d-4e48-8ee8-f59c85f0bead] Completed operation: chat-completion {
  requestId: '4b31a500-da3d-4e48-8ee8-f59c85f0bead',
  timestamp: '2025-02-28T17:25:37.135Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1191,
  metadata: { status: 'success', duration: 1191, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 13353ms
 ✓ Compiled in 909ms (2664 modules)
 ✓ Compiled in 401ms (1480 modules)
 ○ Compiling /dashboard/labs ...
 ✓ Compiled /dashboard/labs in 755ms (1486 modules)
 ✓ Compiled in 629ms (2710 modules)
 ✓ Compiled /api/chat-context in 433ms (1515 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:28:26.751Z] [ERROR] [chat-context] [8c303917-fcb9-47aa-9b82-05ed0dfaaeed] Failed to fetch health score {
  requestId: '8c303917-fcb9-47aa-9b82-05ed0dfaaeed',
  timestamp: '2025-02-28T17:28:26.751Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 331,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:28:26.811Z] [INFO] [chat-context] [8c303917-fcb9-47aa-9b82-05ed0dfaaeed] Added survey data to chat context {
  requestId: '8c303917-fcb9-47aa-9b82-05ed0dfaaeed',
  timestamp: '2025-02-28T17:28:26.811Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 391,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:28:26.933Z] [INFO] [chat-context] [8c303917-fcb9-47aa-9b82-05ed0dfaaeed] Successfully generated chat context {
  requestId: '8c303917-fcb9-47aa-9b82-05ed0dfaaeed',
  timestamp: '2025-02-28T17:28:26.933Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 513,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 1238ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:28:27.175Z] [ERROR] [chat-context] [9f5b5a91-dea1-4ca7-b09a-1b160330788e] Failed to fetch health score {
  requestId: '9f5b5a91-dea1-4ca7-b09a-1b160330788e',
  timestamp: '2025-02-28T17:28:27.175Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 220,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found 12 biomarkers
Fetching insights...
Found health survey data from: 2/28/2025
[2025-02-28T17:28:27.230Z] [INFO] [chat-context] [9f5b5a91-dea1-4ca7-b09a-1b160330788e] Added survey data to chat context {
  requestId: '9f5b5a91-dea1-4ca7-b09a-1b160330788e',
  timestamp: '2025-02-28T17:28:27.230Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 275,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
Found 0 insights
Fetching health score...
No previous reports found
Fetching previous reports for historical context...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:28:27.342Z] [ERROR] [chat-context] [e11d21a1-ab9a-4b0f-a731-94bb552f3f91] Failed to fetch health score {
  requestId: 'e11d21a1-ab9a-4b0f-a731-94bb552f3f91',
  timestamp: '2025-02-28T17:28:27.342Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 308,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:28:27.369Z] [INFO] [chat-context] [9f5b5a91-dea1-4ca7-b09a-1b160330788e] Successfully generated chat context {
  requestId: '9f5b5a91-dea1-4ca7-b09a-1b160330788e',
  timestamp: '2025-02-28T17:28:27.369Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 414,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 432ms
Found health survey data from: 2/28/2025
[2025-02-28T17:28:27.401Z] [INFO] [chat-context] [e11d21a1-ab9a-4b0f-a731-94bb552f3f91] Added survey data to chat context {
  requestId: 'e11d21a1-ab9a-4b0f-a731-94bb552f3f91',
  timestamp: '2025-02-28T17:28:27.401Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 367,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:28:27.513Z] [INFO] [chat-context] [e11d21a1-ab9a-4b0f-a731-94bb552f3f91] Successfully generated chat context {
  requestId: 'e11d21a1-ab9a-4b0f-a731-94bb552f3f91',
  timestamp: '2025-02-28T17:28:27.513Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 479,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 488ms
 ✓ Compiled in 784ms (2742 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:29:01.607Z] [ERROR] [chat-context] [225d8345-8cd5-46eb-a426-7ea43682ee3a] Failed to fetch health score {
  requestId: '225d8345-8cd5-46eb-a426-7ea43682ee3a',
  timestamp: '2025-02-28T17:29:01.607Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 352,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:29:01.676Z] [INFO] [chat-context] [225d8345-8cd5-46eb-a426-7ea43682ee3a] Added survey data to chat context {
  requestId: '225d8345-8cd5-46eb-a426-7ea43682ee3a',
  timestamp: '2025-02-28T17:29:01.676Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 421,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:29:01.835Z] [INFO] [chat-context] [225d8345-8cd5-46eb-a426-7ea43682ee3a] Successfully generated chat context {
  requestId: '225d8345-8cd5-46eb-a426-7ea43682ee3a',
  timestamp: '2025-02-28T17:29:01.835Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 580,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 630ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 0 insights
Fetching health score...
Found 12 biomarkers
Fetching insights...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:29:02.200Z] [ERROR] [chat-context] [9e909281-6d0f-4f9a-adac-2f9d053e51f0] Failed to fetch health score {
  requestId: '9e909281-6d0f-4f9a-adac-2f9d053e51f0',
  timestamp: '2025-02-28T17:29:02.200Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 358,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found 0 insights
Fetching health score...
Found health survey data from: 2/28/2025
[2025-02-28T17:29:02.278Z] [INFO] [chat-context] [9e909281-6d0f-4f9a-adac-2f9d053e51f0] Added survey data to chat context {
  requestId: '9e909281-6d0f-4f9a-adac-2f9d053e51f0',
  timestamp: '2025-02-28T17:29:02.278Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 436,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:29:02.292Z] [ERROR] [chat-context] [ab10899b-c80c-40e1-a912-58cfc0c5927b] Failed to fetch health score {
  requestId: 'ab10899b-c80c-40e1-a912-58cfc0c5927b',
  timestamp: '2025-02-28T17:29:02.292Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 343,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
No previous reports found
Fetching previous reports for historical context...
Found health survey data from: 2/28/2025
[2025-02-28T17:29:02.367Z] [INFO] [chat-context] [ab10899b-c80c-40e1-a912-58cfc0c5927b] Added survey data to chat context {
  requestId: 'ab10899b-c80c-40e1-a912-58cfc0c5927b',
  timestamp: '2025-02-28T17:29:02.367Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 418,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:29:02.439Z] [INFO] [chat-context] [9e909281-6d0f-4f9a-adac-2f9d053e51f0] Successfully generated chat context {
  requestId: '9e909281-6d0f-4f9a-adac-2f9d053e51f0',
  timestamp: '2025-02-28T17:29:02.439Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 597,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 603ms
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:29:02.514Z] [INFO] [chat-context] [ab10899b-c80c-40e1-a912-58cfc0c5927b] Successfully generated chat context {
  requestId: 'ab10899b-c80c-40e1-a912-58cfc0c5927b',
  timestamp: '2025-02-28T17:29:02.514Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 565,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 572ms
 ✓ Compiled in 553ms (2742 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:29:14.451Z] [ERROR] [chat-context] [f8d8af5e-9967-43fa-96df-4cce7578da07] Failed to fetch health score {
  requestId: 'f8d8af5e-9967-43fa-96df-4cce7578da07',
  timestamp: '2025-02-28T17:29:14.451Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 355,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:29:14.525Z] [INFO] [chat-context] [f8d8af5e-9967-43fa-96df-4cce7578da07] Added survey data to chat context {
  requestId: 'f8d8af5e-9967-43fa-96df-4cce7578da07',
  timestamp: '2025-02-28T17:29:14.525Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 429,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:29:14.659Z] [INFO] [chat-context] [f8d8af5e-9967-43fa-96df-4cce7578da07] Successfully generated chat context {
  requestId: 'f8d8af5e-9967-43fa-96df-4cce7578da07',
  timestamp: '2025-02-28T17:29:14.659Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 563,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 578ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard/labs/b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:29:14.946Z] [ERROR] [chat-context] [7e81881f-988e-4fb2-b7c9-d1910bb72799] Failed to fetch health score {
  requestId: '7e81881f-988e-4fb2-b7c9-d1910bb72799',
  timestamp: '2025-02-28T17:29:14.946Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 279,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found 12 biomarkers
Fetching insights...
Found health survey data from: 2/28/2025
[2025-02-28T17:29:15.012Z] [INFO] [chat-context] [7e81881f-988e-4fb2-b7c9-d1910bb72799] Added survey data to chat context {
  requestId: '7e81881f-988e-4fb2-b7c9-d1910bb72799',
  timestamp: '2025-02-28T17:29:15.012Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 345,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
Found 0 insights
Fetching health score...
No previous reports found
Fetching previous reports for historical context...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:29:15.139Z] [ERROR] [chat-context] [ab6abbf5-72ac-4b40-ab62-bfce6731ba6a] Failed to fetch health score {
  requestId: 'ab6abbf5-72ac-4b40-ab62-bfce6731ba6a',
  timestamp: '2025-02-28T17:29:15.139Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 385,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:29:15.169Z] [INFO] [chat-context] [7e81881f-988e-4fb2-b7c9-d1910bb72799] Successfully generated chat context {
  requestId: '7e81881f-988e-4fb2-b7c9-d1910bb72799',
  timestamp: '2025-02-28T17:29:15.169Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 502,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 510ms
Found health survey data from: 2/28/2025
[2025-02-28T17:29:15.224Z] [INFO] [chat-context] [ab6abbf5-72ac-4b40-ab62-bfce6731ba6a] Added survey data to chat context {
  requestId: 'ab6abbf5-72ac-4b40-ab62-bfce6731ba6a',
  timestamp: '2025-02-28T17:29:15.224Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 470,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:29:15.367Z] [INFO] [chat-context] [ab6abbf5-72ac-4b40-ab62-bfce6731ba6a] Successfully generated chat context {
  requestId: 'ab6abbf5-72ac-4b40-ab62-bfce6731ba6a',
  timestamp: '2025-02-28T17:29:15.367Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 613,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 620ms
 ✓ Compiled in 262ms (1225 modules)
 ✓ Compiled in 870ms (2667 modules)
 ✓ Compiled in 1016ms (2667 modules)
 ✓ Compiled in 560ms (2667 modules)
 ✓ Compiled in 339ms (1225 modules)
 ✓ Compiled in 230ms (1225 modules)
 ✓ Compiled in 594ms (2667 modules)
 GET /dashboard 200 in 246ms
 ○ Compiling /api/chat-context ...
 ✓ Compiled /api/chat-context in 602ms (1471 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:33:39.715Z] [ERROR] [chat-context] [034008f1-5cd1-49d7-bc3d-2e7e1fad3d6b] Failed to fetch health score {
  requestId: '034008f1-5cd1-49d7-bc3d-2e7e1fad3d6b',
  timestamp: '2025-02-28T17:33:39.715Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 296,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:33:39.818Z] [INFO] [chat-context] [034008f1-5cd1-49d7-bc3d-2e7e1fad3d6b] Added survey data to chat context {
  requestId: '034008f1-5cd1-49d7-bc3d-2e7e1fad3d6b',
  timestamp: '2025-02-28T17:33:39.818Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 399,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:33:40.047Z] [INFO] [chat-context] [034008f1-5cd1-49d7-bc3d-2e7e1fad3d6b] Successfully generated chat context {
  requestId: '034008f1-5cd1-49d7-bc3d-2e7e1fad3d6b',
  timestamp: '2025-02-28T17:33:40.047Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 628,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 1364ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:33:40.566Z] [ERROR] [chat-context] [aad0ae91-4d5e-4e44-ba5a-b5a8b3860649] Failed to fetch health score {
  requestId: 'aad0ae91-4d5e-4e44-ba5a-b5a8b3860649',
  timestamp: '2025-02-28T17:33:40.566Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 355,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found 12 biomarkers
Fetching insights...
Found health survey data from: 2/28/2025
[2025-02-28T17:33:40.627Z] [INFO] [chat-context] [aad0ae91-4d5e-4e44-ba5a-b5a8b3860649] Added survey data to chat context {
  requestId: 'aad0ae91-4d5e-4e44-ba5a-b5a8b3860649',
  timestamp: '2025-02-28T17:33:40.627Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 416,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
Found 0 insights
Fetching health score...
No previous reports found
Fetching previous reports for historical context...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:33:40.713Z] [ERROR] [chat-context] [e66fbf41-cb2f-4677-91cc-cbd5e4b791e2] Failed to fetch health score {
  requestId: 'e66fbf41-cb2f-4677-91cc-cbd5e4b791e2',
  timestamp: '2025-02-28T17:33:40.713Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 354,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:33:40.746Z] [INFO] [chat-context] [aad0ae91-4d5e-4e44-ba5a-b5a8b3860649] Successfully generated chat context {
  requestId: 'aad0ae91-4d5e-4e44-ba5a-b5a8b3860649',
  timestamp: '2025-02-28T17:33:40.746Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 535,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 611ms
Found health survey data from: 2/28/2025
[2025-02-28T17:33:40.790Z] [INFO] [chat-context] [e66fbf41-cb2f-4677-91cc-cbd5e4b791e2] Added survey data to chat context {
  requestId: 'e66fbf41-cb2f-4677-91cc-cbd5e4b791e2',
  timestamp: '2025-02-28T17:33:40.790Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 431,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:33:40.932Z] [INFO] [chat-context] [e66fbf41-cb2f-4677-91cc-cbd5e4b791e2] Successfully generated chat context {
  requestId: 'e66fbf41-cb2f-4677-91cc-cbd5e4b791e2',
  timestamp: '2025-02-28T17:33:40.932Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 573,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 684ms
 ✓ Compiled /api/chat in 381ms (466 modules)

=== CHAT API CONFIGURATION ===
NODE_ENV: development
OpenAI API key is present: sk-...tgcA (164 chars)
================================


=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "159"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:33:41.775Z] [DEBUG] [api/chat] [a2742470-c769-427c-ac92-43061e884783] Starting operation: chat-completion {
  requestId: 'a2742470-c769-427c-ac92-43061e884783',
  timestamp: '2025-02-28T17:33:41.775Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: d5s34qtf
Attempting to parse request body...
Request body successfully parsed
Messages received: 1
[2025-02-28T17:33:41.778Z] [DEBUG] [api/chat] [a2742470-c769-427c-ac92-43061e884783] Processing chat request {
  requestId: 'a2742470-c769-427c-ac92-43061e884783',
  timestamp: '2025-02-28T17:33:41.778Z',
  userId: undefined,
  route: 'api/chat',
  duration: 3,
  metadata: {
  messageCount: 1,
  lastMessage: {
  role: 'user',
  content: 'hey',
  parts: [ { type: 'text', text: 'hey' } ]
}
}
}
Last message (3 chars): "hey..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:33:42.285Z] [ERROR] [chat-context] [c4cec6cd-c38f-461f-8bc1-f464f69d3653] Failed to fetch health score {
  requestId: 'c4cec6cd-c38f-461f-8bc1-f464f69d3653',
  timestamp: '2025-02-28T17:33:42.285Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 275,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:33:42.349Z] [INFO] [chat-context] [c4cec6cd-c38f-461f-8bc1-f464f69d3653] Added survey data to chat context {
  requestId: 'c4cec6cd-c38f-461f-8bc1-f464f69d3653',
  timestamp: '2025-02-28T17:33:42.349Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 339,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:33:42.494Z] [INFO] [chat-context] [c4cec6cd-c38f-461f-8bc1-f464f69d3653] Successfully generated chat context {
  requestId: 'c4cec6cd-c38f-461f-8bc1-f464f69d3653',
  timestamp: '2025-02-28T17:33:42.494Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 484,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 676ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:33:42.498Z] [INFO] [api/chat] [a2742470-c769-427c-ac92-43061e884783] Survey data available for chat {
  requestId: 'a2742470-c769-427c-ac92-43061e884783',
  timestamp: '2025-02-28T17:33:42.498Z',
  userId: undefined,
  route: 'api/chat',
  duration: 723,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 1
Stream initialized in 3187ms
[2025-02-28T17:33:45.685Z] [INFO] [api/chat] [a2742470-c769-427c-ac92-43061e884783] Completed operation: chat-completion {
  requestId: 'a2742470-c769-427c-ac92-43061e884783',
  timestamp: '2025-02-28T17:33:45.685Z',
  userId: undefined,
  route: 'api/chat',
  duration: 3910,
  metadata: { status: 'success', duration: 3910, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 5708ms
 GET /dashboard 200 in 159ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:33:49.468Z] [ERROR] [chat-context] [95e82c1f-1432-4b05-acef-bb645ba02d74] Failed to fetch health score {
  requestId: '95e82c1f-1432-4b05-acef-bb645ba02d74',
  timestamp: '2025-02-28T17:33:49.468Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 345,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:33:49.546Z] [INFO] [chat-context] [95e82c1f-1432-4b05-acef-bb645ba02d74] Added survey data to chat context {
  requestId: '95e82c1f-1432-4b05-acef-bb645ba02d74',
  timestamp: '2025-02-28T17:33:49.546Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 423,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:33:49.690Z] [INFO] [chat-context] [95e82c1f-1432-4b05-acef-bb645ba02d74] Successfully generated chat context {
  requestId: '95e82c1f-1432-4b05-acef-bb645ba02d74',
  timestamp: '2025-02-28T17:33:49.690Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 567,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 582ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:33:49.962Z] [ERROR] [chat-context] [85a33355-3004-4a9d-91f3-2c87039bbbbc] Failed to fetch health score {
  requestId: '85a33355-3004-4a9d-91f3-2c87039bbbbc',
  timestamp: '2025-02-28T17:33:49.962Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 259,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:33:50.023Z] [INFO] [chat-context] [85a33355-3004-4a9d-91f3-2c87039bbbbc] Added survey data to chat context {
  requestId: '85a33355-3004-4a9d-91f3-2c87039bbbbc',
  timestamp: '2025-02-28T17:33:50.023Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 320,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
Found 12 biomarkers
Fetching insights...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:33:50.150Z] [INFO] [chat-context] [85a33355-3004-4a9d-91f3-2c87039bbbbc] Successfully generated chat context {
  requestId: '85a33355-3004-4a9d-91f3-2c87039bbbbc',
  timestamp: '2025-02-28T17:33:50.150Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 447,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 459ms
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:33:50.224Z] [ERROR] [chat-context] [00f7bece-132e-4161-8241-6a7f08d0d387] Failed to fetch health score {
  requestId: '00f7bece-132e-4161-8241-6a7f08d0d387',
  timestamp: '2025-02-28T17:33:50.224Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 422,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:33:50.297Z] [INFO] [chat-context] [00f7bece-132e-4161-8241-6a7f08d0d387] Added survey data to chat context {
  requestId: '00f7bece-132e-4161-8241-6a7f08d0d387',
  timestamp: '2025-02-28T17:33:50.297Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 495,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:33:50.439Z] [INFO] [chat-context] [00f7bece-132e-4161-8241-6a7f08d0d387] Successfully generated chat context {
  requestId: '00f7bece-132e-4161-8241-6a7f08d0d387',
  timestamp: '2025-02-28T17:33:50.439Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 637,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 649ms

=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "159"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:33:51.898Z] [DEBUG] [api/chat] [ef0b181c-fb5f-4f92-b95e-6b28e9565b2c] Starting operation: chat-completion {
  requestId: 'ef0b181c-fb5f-4f92-b95e-6b28e9565b2c',
  timestamp: '2025-02-28T17:33:51.898Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: yg12omyo
Attempting to parse request body...
Request body successfully parsed
Messages received: 1
[2025-02-28T17:33:51.899Z] [DEBUG] [api/chat] [ef0b181c-fb5f-4f92-b95e-6b28e9565b2c] Processing chat request {
  requestId: 'ef0b181c-fb5f-4f92-b95e-6b28e9565b2c',
  timestamp: '2025-02-28T17:33:51.899Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1,
  metadata: {
  messageCount: 1,
  lastMessage: {
  role: 'user',
  content: 'hey',
  parts: [ { type: 'text', text: 'hey' } ]
}
}
}
Last message (3 chars): "hey..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:33:52.201Z] [ERROR] [chat-context] [186853e2-13a2-40db-af13-31c9f1a01030] Failed to fetch health score {
  requestId: '186853e2-13a2-40db-af13-31c9f1a01030',
  timestamp: '2025-02-28T17:33:52.201Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 285,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:33:52.283Z] [INFO] [chat-context] [186853e2-13a2-40db-af13-31c9f1a01030] Added survey data to chat context {
  requestId: '186853e2-13a2-40db-af13-31c9f1a01030',
  timestamp: '2025-02-28T17:33:52.283Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 367,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:33:52.442Z] [INFO] [chat-context] [186853e2-13a2-40db-af13-31c9f1a01030] Successfully generated chat context {
  requestId: '186853e2-13a2-40db-af13-31c9f1a01030',
  timestamp: '2025-02-28T17:33:52.442Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 526,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 541ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:33:52.446Z] [INFO] [api/chat] [ef0b181c-fb5f-4f92-b95e-6b28e9565b2c] Survey data available for chat {
  requestId: 'ef0b181c-fb5f-4f92-b95e-6b28e9565b2c',
  timestamp: '2025-02-28T17:33:52.446Z',
  userId: undefined,
  route: 'api/chat',
  duration: 548,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 1
Stream initialized in 595ms
[2025-02-28T17:33:53.042Z] [INFO] [api/chat] [ef0b181c-fb5f-4f92-b95e-6b28e9565b2c] Completed operation: chat-completion {
  requestId: 'ef0b181c-fb5f-4f92-b95e-6b28e9565b2c',
  timestamp: '2025-02-28T17:33:53.042Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1144,
  metadata: { status: 'success', duration: 1144, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 2898ms
 GET /dashboard 200 in 82ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:34:06.764Z] [ERROR] [chat-context] [75c636b0-192b-4497-9c93-fbc0dc5812f3] Failed to fetch health score {
  requestId: '75c636b0-192b-4497-9c93-fbc0dc5812f3',
  timestamp: '2025-02-28T17:34:06.764Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 355,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:34:06.815Z] [INFO] [chat-context] [75c636b0-192b-4497-9c93-fbc0dc5812f3] Added survey data to chat context {
  requestId: '75c636b0-192b-4497-9c93-fbc0dc5812f3',
  timestamp: '2025-02-28T17:34:06.815Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 406,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:34:06.965Z] [INFO] [chat-context] [75c636b0-192b-4497-9c93-fbc0dc5812f3] Successfully generated chat context {
  requestId: '75c636b0-192b-4497-9c93-fbc0dc5812f3',
  timestamp: '2025-02-28T17:34:06.965Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 556,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 603ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:34:07.246Z] [ERROR] [chat-context] [861b0628-cbab-4f8f-a2c3-4a2997eccbf4] Failed to fetch health score {
  requestId: '861b0628-cbab-4f8f-a2c3-4a2997eccbf4',
  timestamp: '2025-02-28T17:34:07.246Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 270,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found health survey data from: 2/28/2025
[2025-02-28T17:34:07.303Z] [INFO] [chat-context] [861b0628-cbab-4f8f-a2c3-4a2997eccbf4] Added survey data to chat context {
  requestId: '861b0628-cbab-4f8f-a2c3-4a2997eccbf4',
  timestamp: '2025-02-28T17:34:07.303Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 327,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:34:07.438Z] [INFO] [chat-context] [861b0628-cbab-4f8f-a2c3-4a2997eccbf4] Successfully generated chat context {
  requestId: '861b0628-cbab-4f8f-a2c3-4a2997eccbf4',
  timestamp: '2025-02-28T17:34:07.438Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 462,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 472ms
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:34:07.647Z] [ERROR] [chat-context] [0274018b-6518-428b-9135-1bc22d98a3b4] Failed to fetch health score {
  requestId: '0274018b-6518-428b-9135-1bc22d98a3b4',
  timestamp: '2025-02-28T17:34:07.647Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 359,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:34:07.747Z] [INFO] [chat-context] [0274018b-6518-428b-9135-1bc22d98a3b4] Added survey data to chat context {
  requestId: '0274018b-6518-428b-9135-1bc22d98a3b4',
  timestamp: '2025-02-28T17:34:07.747Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 459,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:34:07.918Z] [INFO] [chat-context] [0274018b-6518-428b-9135-1bc22d98a3b4] Successfully generated chat context {
  requestId: '0274018b-6518-428b-9135-1bc22d98a3b4',
  timestamp: '2025-02-28T17:34:07.918Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 630,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 640ms
 ○ Compiling /dashboard/labs ...
 ✓ Compiled /dashboard/labs in 573ms (1517 modules)
 ✓ Compiled in 868ms (2742 modules)

=== CHAT API CONFIGURATION ===
NODE_ENV: development
OpenAI API key is present: sk-...tgcA (164 chars)
================================


=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "159"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:37:08.650Z] [DEBUG] [api/chat] [a6d6181d-4b22-4c70-8b2f-c671b550cfec] Starting operation: chat-completion {
  requestId: 'a6d6181d-4b22-4c70-8b2f-c671b550cfec',
  timestamp: '2025-02-28T17:37:08.650Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: evz4kdm1
Attempting to parse request body...
Request body successfully parsed
Messages received: 1
[2025-02-28T17:37:08.652Z] [DEBUG] [api/chat] [a6d6181d-4b22-4c70-8b2f-c671b550cfec] Processing chat request {
  requestId: 'a6d6181d-4b22-4c70-8b2f-c671b550cfec',
  timestamp: '2025-02-28T17:37:08.652Z',
  userId: undefined,
  route: 'api/chat',
  duration: 2,
  metadata: {
  messageCount: 1,
  lastMessage: {
  role: 'user',
  content: 'HEY',
  parts: [ { type: 'text', text: 'HEY' } ]
}
}
}
Last message (3 chars): "HEY..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:37:09.287Z] [ERROR] [chat-context] [387125ee-3969-42c5-bfc3-6602344bcf43] Failed to fetch health score {
  requestId: '387125ee-3969-42c5-bfc3-6602344bcf43',
  timestamp: '2025-02-28T17:37:09.287Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 469,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:37:09.402Z] [INFO] [chat-context] [387125ee-3969-42c5-bfc3-6602344bcf43] Added survey data to chat context {
  requestId: '387125ee-3969-42c5-bfc3-6602344bcf43',
  timestamp: '2025-02-28T17:37:09.402Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 584,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:37:09.593Z] [INFO] [chat-context] [387125ee-3969-42c5-bfc3-6602344bcf43] Successfully generated chat context {
  requestId: '387125ee-3969-42c5-bfc3-6602344bcf43',
  timestamp: '2025-02-28T17:37:09.593Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 775,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 883ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:37:09.600Z] [INFO] [api/chat] [a6d6181d-4b22-4c70-8b2f-c671b550cfec] Survey data available for chat {
  requestId: 'a6d6181d-4b22-4c70-8b2f-c671b550cfec',
  timestamp: '2025-02-28T17:37:09.600Z',
  userId: undefined,
  route: 'api/chat',
  duration: 950,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 1
Stream initialized in 539ms
[2025-02-28T17:37:10.139Z] [INFO] [api/chat] [a6d6181d-4b22-4c70-8b2f-c671b550cfec] Completed operation: chat-completion {
  requestId: 'a6d6181d-4b22-4c70-8b2f-c671b550cfec',
  timestamp: '2025-02-28T17:37:10.139Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1489,
  metadata: { status: 'success', duration: 1489, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 2875ms
 GET /dashboard 200 in 303ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:37:13.907Z] [ERROR] [chat-context] [9f860ab1-8eec-42c8-85a4-8c4c1b619f37] Failed to fetch health score {
  requestId: '9f860ab1-8eec-42c8-85a4-8c4c1b619f37',
  timestamp: '2025-02-28T17:37:13.907Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 329,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:37:13.991Z] [INFO] [chat-context] [9f860ab1-8eec-42c8-85a4-8c4c1b619f37] Added survey data to chat context {
  requestId: '9f860ab1-8eec-42c8-85a4-8c4c1b619f37',
  timestamp: '2025-02-28T17:37:13.991Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 413,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:37:14.358Z] [INFO] [chat-context] [9f860ab1-8eec-42c8-85a4-8c4c1b619f37] Successfully generated chat context {
  requestId: '9f860ab1-8eec-42c8-85a4-8c4c1b619f37',
  timestamp: '2025-02-28T17:37:14.358Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 780,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:37:15.356Z] [ERROR] [chat-context] [9e857990-5a78-4828-9d0d-964f65643756] Failed to fetch health score {
  requestId: '9e857990-5a78-4828-9d0d-964f65643756',
  timestamp: '2025-02-28T17:37:15.356Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 385,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:37:15.444Z] [INFO] [chat-context] [9e857990-5a78-4828-9d0d-964f65643756] Added survey data to chat context {
  requestId: '9e857990-5a78-4828-9d0d-964f65643756',
  timestamp: '2025-02-28T17:37:15.444Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 473,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:37:15.600Z] [INFO] [chat-context] [9e857990-5a78-4828-9d0d-964f65643756] Successfully generated chat context {
  requestId: '9e857990-5a78-4828-9d0d-964f65643756',
  timestamp: '2025-02-28T17:37:15.600Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 629,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 642ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:37:15.919Z] [ERROR] [chat-context] [2e8b0854-6921-424d-9a75-fd8042d12872] Failed to fetch health score {
  requestId: '2e8b0854-6921-424d-9a75-fd8042d12872',
  timestamp: '2025-02-28T17:37:15.919Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 302,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found 12 biomarkers
Fetching insights...
Found health survey data from: 2/28/2025
[2025-02-28T17:37:15.986Z] [INFO] [chat-context] [2e8b0854-6921-424d-9a75-fd8042d12872] Added survey data to chat context {
  requestId: '2e8b0854-6921-424d-9a75-fd8042d12872',
  timestamp: '2025-02-28T17:37:15.986Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 369,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
Found 0 insights
Fetching health score...
No previous reports found
Fetching previous reports for historical context...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:37:16.079Z] [ERROR] [chat-context] [1862e9bb-9ac1-412a-80a9-b2dbad4b59ce] Failed to fetch health score {
  requestId: '1862e9bb-9ac1-412a-80a9-b2dbad4b59ce',
  timestamp: '2025-02-28T17:37:16.079Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 363,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:37:16.116Z] [INFO] [chat-context] [2e8b0854-6921-424d-9a75-fd8042d12872] Successfully generated chat context {
  requestId: '2e8b0854-6921-424d-9a75-fd8042d12872',
  timestamp: '2025-02-28T17:37:16.116Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 499,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 514ms
Found health survey data from: 2/28/2025
[2025-02-28T17:37:16.146Z] [INFO] [chat-context] [1862e9bb-9ac1-412a-80a9-b2dbad4b59ce] Added survey data to chat context {
  requestId: '1862e9bb-9ac1-412a-80a9-b2dbad4b59ce',
  timestamp: '2025-02-28T17:37:16.146Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 430,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:37:16.308Z] [INFO] [chat-context] [1862e9bb-9ac1-412a-80a9-b2dbad4b59ce] Successfully generated chat context {
  requestId: '1862e9bb-9ac1-412a-80a9-b2dbad4b59ce',
  timestamp: '2025-02-28T17:37:16.308Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 592,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 602ms

=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "159"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:37:53.209Z] [DEBUG] [api/chat] [a32668c7-7698-47e7-bca8-66aecd1abefb] Starting operation: chat-completion {
  requestId: 'a32668c7-7698-47e7-bca8-66aecd1abefb',
  timestamp: '2025-02-28T17:37:53.209Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: 95c0n8vb
Attempting to parse request body...
Request body successfully parsed
Messages received: 1
[2025-02-28T17:37:53.211Z] [DEBUG] [api/chat] [a32668c7-7698-47e7-bca8-66aecd1abefb] Processing chat request {
  requestId: 'a32668c7-7698-47e7-bca8-66aecd1abefb',
  timestamp: '2025-02-28T17:37:53.211Z',
  userId: undefined,
  route: 'api/chat',
  duration: 2,
  metadata: {
  messageCount: 1,
  lastMessage: {
  role: 'user',
  content: 'hey',
  parts: [ { type: 'text', text: 'hey' } ]
}
}
}
Last message (3 chars): "hey..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:37:53.864Z] [ERROR] [chat-context] [84ad0b25-57bb-4e20-95f1-5a84ec1fbd01] Failed to fetch health score {
  requestId: '84ad0b25-57bb-4e20-95f1-5a84ec1fbd01',
  timestamp: '2025-02-28T17:37:53.864Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 567,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:37:53.961Z] [INFO] [chat-context] [84ad0b25-57bb-4e20-95f1-5a84ec1fbd01] Added survey data to chat context {
  requestId: '84ad0b25-57bb-4e20-95f1-5a84ec1fbd01',
  timestamp: '2025-02-28T17:37:53.961Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 664,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:37:54.096Z] [INFO] [chat-context] [84ad0b25-57bb-4e20-95f1-5a84ec1fbd01] Successfully generated chat context {
  requestId: '84ad0b25-57bb-4e20-95f1-5a84ec1fbd01',
  timestamp: '2025-02-28T17:37:54.096Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 799,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 956ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:37:54.550Z] [INFO] [api/chat] [a32668c7-7698-47e7-bca8-66aecd1abefb] Survey data available for chat {
  requestId: 'a32668c7-7698-47e7-bca8-66aecd1abefb',
  timestamp: '2025-02-28T17:37:54.550Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1340,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 1
Stream initialized in 608ms
[2025-02-28T17:37:55.190Z] [INFO] [api/chat] [a32668c7-7698-47e7-bca8-66aecd1abefb] Completed operation: chat-completion {
  requestId: 'a32668c7-7698-47e7-bca8-66aecd1abefb',
  timestamp: '2025-02-28T17:37:55.190Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1981,
  metadata: { status: 'success', duration: 1981, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 2907ms
 GET /dashboard 200 in 73ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:37:58.607Z] [ERROR] [chat-context] [d6770803-5901-424a-a247-90f7f9ab13e0] Failed to fetch health score {
  requestId: 'd6770803-5901-424a-a247-90f7f9ab13e0',
  timestamp: '2025-02-28T17:37:58.607Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 307,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:37:58.674Z] [INFO] [chat-context] [d6770803-5901-424a-a247-90f7f9ab13e0] Added survey data to chat context {
  requestId: 'd6770803-5901-424a-a247-90f7f9ab13e0',
  timestamp: '2025-02-28T17:37:58.674Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 374,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:37:58.846Z] [INFO] [chat-context] [d6770803-5901-424a-a247-90f7f9ab13e0] Successfully generated chat context {
  requestId: 'd6770803-5901-424a-a247-90f7f9ab13e0',
  timestamp: '2025-02-28T17:37:58.846Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 546,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 561ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:37:59.179Z] [ERROR] [chat-context] [b4891729-345a-4de3-aa4c-d873f2b26c6e] Failed to fetch health score {
  requestId: 'b4891729-345a-4de3-aa4c-d873f2b26c6e',
  timestamp: '2025-02-28T17:37:59.179Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 307,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:37:59.253Z] [INFO] [chat-context] [b4891729-345a-4de3-aa4c-d873f2b26c6e] Added survey data to chat context {
  requestId: 'b4891729-345a-4de3-aa4c-d873f2b26c6e',
  timestamp: '2025-02-28T17:37:59.253Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 381,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
No previous reports found
Fetching previous reports for historical context...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:37:59.442Z] [INFO] [chat-context] [b4891729-345a-4de3-aa4c-d873f2b26c6e] Successfully generated chat context {
  requestId: 'b4891729-345a-4de3-aa4c-d873f2b26c6e',
  timestamp: '2025-02-28T17:37:59.442Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 570,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 593ms
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:37:59.836Z] [ERROR] [chat-context] [2d56e9a5-d51e-4ffe-b085-3aa00871de0c] Failed to fetch health score {
  requestId: '2d56e9a5-d51e-4ffe-b085-3aa00871de0c',
  timestamp: '2025-02-28T17:37:59.836Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 560,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:37:59.924Z] [INFO] [chat-context] [2d56e9a5-d51e-4ffe-b085-3aa00871de0c] Added survey data to chat context {
  requestId: '2d56e9a5-d51e-4ffe-b085-3aa00871de0c',
  timestamp: '2025-02-28T17:37:59.924Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 648,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:38:00.372Z] [INFO] [chat-context] [2d56e9a5-d51e-4ffe-b085-3aa00871de0c] Successfully generated chat context {
  requestId: '2d56e9a5-d51e-4ffe-b085-3aa00871de0c',
  timestamp: '2025-02-28T17:38:00.372Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 1096,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 1112ms
 ✓ Compiled in 1149ms (2696 modules)
 ✓ Compiled in 418ms (2696 modules)
 ✓ Compiled in 913ms (2696 modules)
 ✓ Compiled in 297ms (2696 modules)
 ✓ Compiled in 441ms (2696 modules)
 ✓ Compiled in 763ms (2661 modules)
 ✓ Compiled in 838ms (2661 modules)

=== CHAT API CONFIGURATION ===
NODE_ENV: development
OpenAI API key is present: sk-...tgcA (164 chars)
================================


=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "159"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:41:44.790Z] [DEBUG] [api/chat] [a1931c56-c1c2-4763-965e-94e246fc0171] Starting operation: chat-completion {
  requestId: 'a1931c56-c1c2-4763-965e-94e246fc0171',
  timestamp: '2025-02-28T17:41:44.790Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: no49rnp6
Attempting to parse request body...
Request body successfully parsed
Messages received: 1
[2025-02-28T17:41:44.794Z] [DEBUG] [api/chat] [a1931c56-c1c2-4763-965e-94e246fc0171] Processing chat request {
  requestId: 'a1931c56-c1c2-4763-965e-94e246fc0171',
  timestamp: '2025-02-28T17:41:44.794Z',
  userId: undefined,
  route: 'api/chat',
  duration: 4,
  metadata: {
  messageCount: 1,
  lastMessage: {
  role: 'user',
  content: 'get',
  parts: [ { type: 'text', text: 'get' } ]
}
}
}
Last message (3 chars): "get..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
 ○ Compiling /api/chat-context ...
 ✓ Compiled /api/chat-context in 623ms (1465 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:41:46.451Z] [ERROR] [chat-context] [ece52ac9-8e54-4404-b03c-c39e03d0d955] Failed to fetch health score {
  requestId: 'ece52ac9-8e54-4404-b03c-c39e03d0d955',
  timestamp: '2025-02-28T17:41:46.451Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 912,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:41:46.964Z] [INFO] [chat-context] [ece52ac9-8e54-4404-b03c-c39e03d0d955] Added survey data to chat context {
  requestId: 'ece52ac9-8e54-4404-b03c-c39e03d0d955',
  timestamp: '2025-02-28T17:41:46.964Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 1427,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:41:47.177Z] [INFO] [chat-context] [ece52ac9-8e54-4404-b03c-c39e03d0d955] Successfully generated chat context {
  requestId: 'ece52ac9-8e54-4404-b03c-c39e03d0d955',
  timestamp: '2025-02-28T17:41:47.177Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 1640,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 2386ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:41:47.213Z] [INFO] [api/chat] [a1931c56-c1c2-4763-965e-94e246fc0171] Survey data available for chat {
  requestId: 'a1931c56-c1c2-4763-965e-94e246fc0171',
  timestamp: '2025-02-28T17:41:47.213Z',
  userId: undefined,
  route: 'api/chat',
  duration: 2423,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 1
Stream initialized in 510ms
[2025-02-28T17:41:47.723Z] [INFO] [api/chat] [a1931c56-c1c2-4763-965e-94e246fc0171] Completed operation: chat-completion {
  requestId: 'a1931c56-c1c2-4763-965e-94e246fc0171',
  timestamp: '2025-02-28T17:41:47.723Z',
  userId: undefined,
  route: 'api/chat',
  duration: 2933,
  metadata: { status: 'success', duration: 2933, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 5387ms

=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "660"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:42:02.590Z] [DEBUG] [api/chat] [79b33830-2aa5-430b-84c7-8bbba21eb277] Starting operation: chat-completion {
  requestId: '79b33830-2aa5-430b-84c7-8bbba21eb277',
  timestamp: '2025-02-28T17:42:02.590Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: 1fu88py4
Attempting to parse request body...
Request body successfully parsed
Messages received: 3
[2025-02-28T17:42:02.591Z] [DEBUG] [api/chat] [79b33830-2aa5-430b-84c7-8bbba21eb277] Processing chat request {
  requestId: '79b33830-2aa5-430b-84c7-8bbba21eb277',
  timestamp: '2025-02-28T17:42:02.591Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1,
  metadata: {
  messageCount: 3,
  lastMessage: {
  role: 'user',
  content: 'reccommendations? ',
  parts: [ { type: 'text', text: 'reccommendations? ' } ]
}
}
}
Last message (18 chars): "reccommendations? ..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:42:03.037Z] [ERROR] [chat-context] [a0e3e409-2b65-4cce-80bd-3f2ee85fc655] Failed to fetch health score {
  requestId: 'a0e3e409-2b65-4cce-80bd-3f2ee85fc655',
  timestamp: '2025-02-28T17:42:03.037Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 428,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:42:03.165Z] [INFO] [chat-context] [a0e3e409-2b65-4cce-80bd-3f2ee85fc655] Added survey data to chat context {
  requestId: 'a0e3e409-2b65-4cce-80bd-3f2ee85fc655',
  timestamp: '2025-02-28T17:42:03.165Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 556,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:42:03.318Z] [INFO] [chat-context] [a0e3e409-2b65-4cce-80bd-3f2ee85fc655] Successfully generated chat context {
  requestId: 'a0e3e409-2b65-4cce-80bd-3f2ee85fc655',
  timestamp: '2025-02-28T17:42:03.318Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 709,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 725ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:42:03.322Z] [INFO] [api/chat] [79b33830-2aa5-430b-84c7-8bbba21eb277] Survey data available for chat {
  requestId: '79b33830-2aa5-430b-84c7-8bbba21eb277',
  timestamp: '2025-02-28T17:42:03.322Z',
  userId: undefined,
  route: 'api/chat',
  duration: 732,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 3
Stream initialized in 614ms
[2025-02-28T17:42:03.936Z] [INFO] [api/chat] [79b33830-2aa5-430b-84c7-8bbba21eb277] Completed operation: chat-completion {
  requestId: '79b33830-2aa5-430b-84c7-8bbba21eb277',
  timestamp: '2025-02-28T17:42:03.936Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1346,
  metadata: { status: 'success', duration: 1346, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 14694ms
 ✓ Compiled in 1113ms (1481 modules)
 ✓ Compiled in 1403ms (1225 modules)
 GET /dashboard 200 in 355ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:47:58.552Z] [ERROR] [chat-context] [f1f08fbe-7bc1-441c-a1e5-765ddd31f933] Failed to fetch health score {
  requestId: 'f1f08fbe-7bc1-441c-a1e5-765ddd31f933',
  timestamp: '2025-02-28T17:47:58.552Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 429,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:47:58.625Z] [INFO] [chat-context] [f1f08fbe-7bc1-441c-a1e5-765ddd31f933] Added survey data to chat context {
  requestId: 'f1f08fbe-7bc1-441c-a1e5-765ddd31f933',
  timestamp: '2025-02-28T17:47:58.625Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 502,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:47:58.808Z] [INFO] [chat-context] [f1f08fbe-7bc1-441c-a1e5-765ddd31f933] Successfully generated chat context {
  requestId: 'f1f08fbe-7bc1-441c-a1e5-765ddd31f933',
  timestamp: '2025-02-28T17:47:58.808Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 685,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 758ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 0 insights
Fetching health score...
Found 12 biomarkers
Fetching insights...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:47:59.104Z] [ERROR] [chat-context] [dc49bcf6-9f7b-4b77-9212-d8d5f671bf71] Failed to fetch health score {
  requestId: 'dc49bcf6-9f7b-4b77-9212-d8d5f671bf71',
  timestamp: '2025-02-28T17:47:59.104Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 276,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found 0 insights
Fetching health score...
Found health survey data from: 2/28/2025
[2025-02-28T17:47:59.167Z] [INFO] [chat-context] [dc49bcf6-9f7b-4b77-9212-d8d5f671bf71] Added survey data to chat context {
  requestId: 'dc49bcf6-9f7b-4b77-9212-d8d5f671bf71',
  timestamp: '2025-02-28T17:47:59.167Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 339,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:47:59.214Z] [ERROR] [chat-context] [a4f2af76-fdd0-43e6-8686-f01dfd8b2baf] Failed to fetch health score {
  requestId: 'a4f2af76-fdd0-43e6-8686-f01dfd8b2baf',
  timestamp: '2025-02-28T17:47:59.214Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 301,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:47:59.295Z] [INFO] [chat-context] [dc49bcf6-9f7b-4b77-9212-d8d5f671bf71] Successfully generated chat context {
  requestId: 'dc49bcf6-9f7b-4b77-9212-d8d5f671bf71',
  timestamp: '2025-02-28T17:47:59.295Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 467,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 483ms
Found health survey data from: 2/28/2025
[2025-02-28T17:47:59.309Z] [INFO] [chat-context] [a4f2af76-fdd0-43e6-8686-f01dfd8b2baf] Added survey data to chat context {
  requestId: 'a4f2af76-fdd0-43e6-8686-f01dfd8b2baf',
  timestamp: '2025-02-28T17:47:59.309Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 396,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:47:59.470Z] [INFO] [chat-context] [a4f2af76-fdd0-43e6-8686-f01dfd8b2baf] Successfully generated chat context {
  requestId: 'a4f2af76-fdd0-43e6-8686-f01dfd8b2baf',
  timestamp: '2025-02-28T17:47:59.470Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 557,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 581ms
 ○ Compiling /api/chat ...
 ✓ Compiled /api/chat in 1572ms (466 modules)

=== CHAT API CONFIGURATION ===
NODE_ENV: development
OpenAI API key is present: sk-...tgcA (164 chars)
================================


=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "159"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:48:01.113Z] [DEBUG] [api/chat] [9052c44f-3f6b-46af-a50f-4321845b6818] Starting operation: chat-completion {
  requestId: '9052c44f-3f6b-46af-a50f-4321845b6818',
  timestamp: '2025-02-28T17:48:01.113Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: tur2g1a6
Attempting to parse request body...
Request body successfully parsed
Messages received: 1
[2025-02-28T17:48:01.115Z] [DEBUG] [api/chat] [9052c44f-3f6b-46af-a50f-4321845b6818] Processing chat request {
  requestId: '9052c44f-3f6b-46af-a50f-4321845b6818',
  timestamp: '2025-02-28T17:48:01.115Z',
  userId: undefined,
  route: 'api/chat',
  duration: 2,
  metadata: {
  messageCount: 1,
  lastMessage: {
  role: 'user',
  content: 'hey',
  parts: [ { type: 'text', text: 'hey' } ]
}
}
}
Last message (3 chars): "hey..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:48:01.586Z] [ERROR] [chat-context] [e2ffb2f5-84d4-4e94-896a-e8fe15278807] Failed to fetch health score {
  requestId: 'e2ffb2f5-84d4-4e94-896a-e8fe15278807',
  timestamp: '2025-02-28T17:48:01.586Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 371,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:48:01.664Z] [INFO] [chat-context] [e2ffb2f5-84d4-4e94-896a-e8fe15278807] Added survey data to chat context {
  requestId: 'e2ffb2f5-84d4-4e94-896a-e8fe15278807',
  timestamp: '2025-02-28T17:48:01.664Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 449,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:48:01.821Z] [INFO] [chat-context] [e2ffb2f5-84d4-4e94-896a-e8fe15278807] Successfully generated chat context {
  requestId: 'e2ffb2f5-84d4-4e94-896a-e8fe15278807',
  timestamp: '2025-02-28T17:48:01.821Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 606,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 698ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:48:01.825Z] [INFO] [api/chat] [9052c44f-3f6b-46af-a50f-4321845b6818] Survey data available for chat {
  requestId: '9052c44f-3f6b-46af-a50f-4321845b6818',
  timestamp: '2025-02-28T17:48:01.825Z',
  userId: undefined,
  route: 'api/chat',
  duration: 711,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 1
Stream initialized in 589ms
[2025-02-28T17:48:02.414Z] [INFO] [api/chat] [9052c44f-3f6b-46af-a50f-4321845b6818] Completed operation: chat-completion {
  requestId: '9052c44f-3f6b-46af-a50f-4321845b6818',
  timestamp: '2025-02-28T17:48:02.414Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1301,
  metadata: { status: 'success', duration: 1301, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 3933ms

=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "468"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:48:11.796Z] [DEBUG] [api/chat] [62fa77ae-4574-49b9-9bc3-fecb7ef809af] Starting operation: chat-completion {
  requestId: '62fa77ae-4574-49b9-9bc3-fecb7ef809af',
  timestamp: '2025-02-28T17:48:11.796Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: oi84c3nn
Attempting to parse request body...
Request body successfully parsed
Messages received: 3
[2025-02-28T17:48:11.797Z] [DEBUG] [api/chat] [62fa77ae-4574-49b9-9bc3-fecb7ef809af] Processing chat request {
  requestId: '62fa77ae-4574-49b9-9bc3-fecb7ef809af',
  timestamp: '2025-02-28T17:48:11.797Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1,
  metadata: {
  messageCount: 3,
  lastMessage: {
  role: 'user',
  content: 'tell me about my health',
  parts: [ { type: 'text', text: 'tell me about my health' } ]
}
}
}
Last message (23 chars): "tell me about my health..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:48:12.246Z] [ERROR] [chat-context] [19432ff3-6884-42a1-9bea-a1f56b08af8e] Failed to fetch health score {
  requestId: '19432ff3-6884-42a1-9bea-a1f56b08af8e',
  timestamp: '2025-02-28T17:48:12.246Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 406,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:48:12.323Z] [INFO] [chat-context] [19432ff3-6884-42a1-9bea-a1f56b08af8e] Added survey data to chat context {
  requestId: '19432ff3-6884-42a1-9bea-a1f56b08af8e',
  timestamp: '2025-02-28T17:48:12.323Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 483,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:48:12.523Z] [INFO] [chat-context] [19432ff3-6884-42a1-9bea-a1f56b08af8e] Successfully generated chat context {
  requestId: '19432ff3-6884-42a1-9bea-a1f56b08af8e',
  timestamp: '2025-02-28T17:48:12.523Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 683,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 727ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:48:12.533Z] [INFO] [api/chat] [62fa77ae-4574-49b9-9bc3-fecb7ef809af] Survey data available for chat {
  requestId: '62fa77ae-4574-49b9-9bc3-fecb7ef809af',
  timestamp: '2025-02-28T17:48:12.533Z',
  userId: undefined,
  route: 'api/chat',
  duration: 737,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 3
Stream initialized in 677ms
[2025-02-28T17:48:13.210Z] [INFO] [api/chat] [62fa77ae-4574-49b9-9bc3-fecb7ef809af] Completed operation: chat-completion {
  requestId: '62fa77ae-4574-49b9-9bc3-fecb7ef809af',
  timestamp: '2025-02-28T17:48:13.210Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1414,
  metadata: { status: 'success', duration: 1414, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 32108ms
 ✓ Compiled in 584ms (1481 modules)
 ✓ Compiled in 778ms (2661 modules)
 GET /dashboard 200 in 217ms
 ○ Compiling /api/chat-context ...
 ✓ Compiled /api/chat-context in 544ms (1465 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:50:57.669Z] [ERROR] [chat-context] [cb994147-4bec-4924-a5a1-adc030207ce8] Failed to fetch health score {
  requestId: 'cb994147-4bec-4924-a5a1-adc030207ce8',
  timestamp: '2025-02-28T17:50:57.669Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 401,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:50:57.741Z] [INFO] [chat-context] [cb994147-4bec-4924-a5a1-adc030207ce8] Added survey data to chat context {
  requestId: 'cb994147-4bec-4924-a5a1-adc030207ce8',
  timestamp: '2025-02-28T17:50:57.741Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 473,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:50:57.884Z] [INFO] [chat-context] [cb994147-4bec-4924-a5a1-adc030207ce8] Successfully generated chat context {
  requestId: 'cb994147-4bec-4924-a5a1-adc030207ce8',
  timestamp: '2025-02-28T17:50:57.884Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 616,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 1600ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:50:58.249Z] [ERROR] [chat-context] [8790e7b2-2402-452e-b231-8ed6e686eaa3] Failed to fetch health score {
  requestId: '8790e7b2-2402-452e-b231-8ed6e686eaa3',
  timestamp: '2025-02-28T17:50:58.249Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 353,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found 0 insights
Fetching health score...
 ✓ Compiled /api/chat in 116ms (466 modules)

=== CHAT API CONFIGURATION ===
NODE_ENV: development
OpenAI API key is present: sk-...tgcA (164 chars)
================================


=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "159"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:50:58.374Z] [DEBUG] [api/chat] [1c26cb42-437f-4ad0-aa7f-3f2bc16e15a1] Starting operation: chat-completion {
  requestId: '1c26cb42-437f-4ad0-aa7f-3f2bc16e15a1',
  timestamp: '2025-02-28T17:50:58.374Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: 30wat3xi
Attempting to parse request body...
Request body successfully parsed
Messages received: 1
[2025-02-28T17:50:58.377Z] [DEBUG] [api/chat] [1c26cb42-437f-4ad0-aa7f-3f2bc16e15a1] Processing chat request {
  requestId: '1c26cb42-437f-4ad0-aa7f-3f2bc16e15a1',
  timestamp: '2025-02-28T17:50:58.377Z',
  userId: undefined,
  route: 'api/chat',
  duration: 3,
  metadata: {
  messageCount: 1,
  lastMessage: {
  role: 'user',
  content: 'hey',
  parts: [ { type: 'text', text: 'hey' } ]
}
}
}
Last message (3 chars): "hey..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:50:58.386Z] [ERROR] [chat-context] [5121ae31-928b-450a-9c30-b1819c6ccbe8] Failed to fetch health score {
  requestId: '5121ae31-928b-450a-9c30-b1819c6ccbe8',
  timestamp: '2025-02-28T17:50:58.386Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 404,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:50:58.390Z] [INFO] [chat-context] [8790e7b2-2402-452e-b231-8ed6e686eaa3] Added survey data to chat context {
  requestId: '8790e7b2-2402-452e-b231-8ed6e686eaa3',
  timestamp: '2025-02-28T17:50:58.390Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 494,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
No previous reports found
Fetching previous reports for historical context...
Found health survey data from: 2/28/2025
[2025-02-28T17:50:58.486Z] [INFO] [chat-context] [5121ae31-928b-450a-9c30-b1819c6ccbe8] Added survey data to chat context {
  requestId: '5121ae31-928b-450a-9c30-b1819c6ccbe8',
  timestamp: '2025-02-28T17:50:58.486Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 504,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:50:58.558Z] [INFO] [chat-context] [8790e7b2-2402-452e-b231-8ed6e686eaa3] Successfully generated chat context {
  requestId: '8790e7b2-2402-452e-b231-8ed6e686eaa3',
  timestamp: '2025-02-28T17:50:58.558Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 662,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 672ms
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:50:58.668Z] [INFO] [chat-context] [5121ae31-928b-450a-9c30-b1819c6ccbe8] Successfully generated chat context {
  requestId: '5121ae31-928b-450a-9c30-b1819c6ccbe8',
  timestamp: '2025-02-28T17:50:58.668Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 686,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 698ms
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:50:58.805Z] [ERROR] [chat-context] [c86745aa-48ee-4367-82df-d88dc5ff4c55] Failed to fetch health score {
  requestId: 'c86745aa-48ee-4367-82df-d88dc5ff4c55',
  timestamp: '2025-02-28T17:50:58.805Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 364,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:50:58.873Z] [INFO] [chat-context] [c86745aa-48ee-4367-82df-d88dc5ff4c55] Added survey data to chat context {
  requestId: 'c86745aa-48ee-4367-82df-d88dc5ff4c55',
  timestamp: '2025-02-28T17:50:58.873Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 432,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:50:59.001Z] [INFO] [chat-context] [c86745aa-48ee-4367-82df-d88dc5ff4c55] Successfully generated chat context {
  requestId: 'c86745aa-48ee-4367-82df-d88dc5ff4c55',
  timestamp: '2025-02-28T17:50:59.001Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 560,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 611ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:50:59.006Z] [INFO] [api/chat] [1c26cb42-437f-4ad0-aa7f-3f2bc16e15a1] Survey data available for chat {
  requestId: '1c26cb42-437f-4ad0-aa7f-3f2bc16e15a1',
  timestamp: '2025-02-28T17:50:59.006Z',
  userId: undefined,
  route: 'api/chat',
  duration: 632,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 1
Stream initialized in 798ms
[2025-02-28T17:50:59.804Z] [INFO] [api/chat] [1c26cb42-437f-4ad0-aa7f-3f2bc16e15a1] Completed operation: chat-completion {
  requestId: '1c26cb42-437f-4ad0-aa7f-3f2bc16e15a1',
  timestamp: '2025-02-28T17:50:59.804Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1430,
  metadata: { status: 'success', duration: 1430, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 2508ms

=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "478"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:51:06.045Z] [DEBUG] [api/chat] [3b669da8-1fd1-4530-b8f4-77a7ba68c845] Starting operation: chat-completion {
  requestId: '3b669da8-1fd1-4530-b8f4-77a7ba68c845',
  timestamp: '2025-02-28T17:51:06.045Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: dl9re914
Attempting to parse request body...
Request body successfully parsed
Messages received: 3
[2025-02-28T17:51:06.047Z] [DEBUG] [api/chat] [3b669da8-1fd1-4530-b8f4-77a7ba68c845] Processing chat request {
  requestId: '3b669da8-1fd1-4530-b8f4-77a7ba68c845',
  timestamp: '2025-02-28T17:51:06.047Z',
  userId: undefined,
  route: 'api/chat',
  duration: 2,
  metadata: {
  messageCount: 3,
  lastMessage: {
  role: 'user',
  content: 'tell me about my health',
  parts: [ { type: 'text', text: 'tell me about my health' } ]
}
}
}
Last message (23 chars): "tell me about my health..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:51:06.564Z] [ERROR] [chat-context] [a2fae637-4383-400a-93d2-9a0b8baa7028] Failed to fetch health score {
  requestId: 'a2fae637-4383-400a-93d2-9a0b8baa7028',
  timestamp: '2025-02-28T17:51:06.564Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 489,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:51:06.695Z] [INFO] [chat-context] [a2fae637-4383-400a-93d2-9a0b8baa7028] Added survey data to chat context {
  requestId: 'a2fae637-4383-400a-93d2-9a0b8baa7028',
  timestamp: '2025-02-28T17:51:06.695Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 620,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:51:06.955Z] [INFO] [chat-context] [a2fae637-4383-400a-93d2-9a0b8baa7028] Successfully generated chat context {
  requestId: 'a2fae637-4383-400a-93d2-9a0b8baa7028',
  timestamp: '2025-02-28T17:51:06.955Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 880,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 928ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:51:07.019Z] [INFO] [api/chat] [3b669da8-1fd1-4530-b8f4-77a7ba68c845] Survey data available for chat {
  requestId: '3b669da8-1fd1-4530-b8f4-77a7ba68c845',
  timestamp: '2025-02-28T17:51:07.019Z',
  userId: undefined,
  route: 'api/chat',
  duration: 974,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 3
Stream initialized in 703ms
[2025-02-28T17:51:07.722Z] [INFO] [api/chat] [3b669da8-1fd1-4530-b8f4-77a7ba68c845] Completed operation: chat-completion {
  requestId: '3b669da8-1fd1-4530-b8f4-77a7ba68c845',
  timestamp: '2025-02-28T17:51:07.722Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1677,
  metadata: { status: 'success', duration: 1677, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 10681ms

=== CHAT API REQUEST ===
Request URL: http://localhost:3000/api/chat
Request method: POST
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "content-length",
    "2307"
  ],
  [
    "content-type",
    "application/json"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "origin",
    "http://localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
[2025-02-28T17:51:47.358Z] [DEBUG] [api/chat] [cecc2387-a89e-4f23-a528-e0faa372a655] Starting operation: chat-completion {
  requestId: 'cecc2387-a89e-4f23-a528-e0faa372a655',
  timestamp: '2025-02-28T17:51:47.358Z',
  userId: undefined,
  route: 'api/chat',
  duration: 0
}
Chat request ID: bskza078
Attempting to parse request body...
Request body successfully parsed
Messages received: 5
[2025-02-28T17:51:47.360Z] [DEBUG] [api/chat] [cecc2387-a89e-4f23-a528-e0faa372a655] Processing chat request {
  requestId: 'cecc2387-a89e-4f23-a528-e0faa372a655',
  timestamp: '2025-02-28T17:51:47.360Z',
  userId: undefined,
  route: 'api/chat',
  duration: 2,
  metadata: {
  messageCount: 5,
  lastMessage: {
  role: 'user',
  content: 'what were my vitamin D levels last time?',
  parts: [ { type: 'text', text: 'what were my vitamin D levels last time?' } ]
}
}
}
Last message (40 chars): "what were my vitamin D levels last time?..."
Report ID specified in request: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Fetching lab context...
Fetching context from: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate"
  ],
  [
    "accept-language",
    "*"
  ],
  [
    "cache-control",
    "no-cache"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "pragma",
    "no-cache"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "user-agent",
    "Next.js Middleware"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ],
  [
    "x-middleware-subrequest",
    "app/api/chat/route"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:51:47.851Z] [ERROR] [chat-context] [ebd6562c-ccea-44eb-ac3e-cf34be02e3c4] Failed to fetch health score {
  requestId: 'ebd6562c-ccea-44eb-ac3e-cf34be02e3c4',
  timestamp: '2025-02-28T17:51:47.851Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 466,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:51:47.939Z] [INFO] [chat-context] [ebd6562c-ccea-44eb-ac3e-cf34be02e3c4] Added survey data to chat context {
  requestId: 'ebd6562c-ccea-44eb-ac3e-cf34be02e3c4',
  timestamp: '2025-02-28T17:51:47.939Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 554,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:51:48.109Z] [INFO] [chat-context] [ebd6562c-ccea-44eb-ac3e-cf34be02e3c4] Successfully generated chat context {
  requestId: 'ebd6562c-ccea-44eb-ac3e-cf34be02e3c4',
  timestamp: '2025-02-28T17:51:48.109Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 724,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 746ms
Lab context fetched successfully: has results
Report: Uploaded Lab (February 28, 2025)
Biomarkers: 12 total, 4 abnormal
[2025-02-28T17:51:48.120Z] [INFO] [api/chat] [cecc2387-a89e-4f23-a528-e0faa372a655] Survey data available for chat {
  requestId: 'cecc2387-a89e-4f23-a528-e0faa372a655',
  timestamp: '2025-02-28T17:51:48.120Z',
  userId: undefined,
  route: 'api/chat',
  duration: 762,
  metadata: { surveyDate: 'February 28, 2025', hasSurveyAIRecs: true }
}
Creating streaming response...
Testing OpenAI connectivity before streaming...
OpenAI connectivity test successful
Calling streamText with messages length: 5
Stream initialized in 279ms
[2025-02-28T17:51:48.399Z] [INFO] [api/chat] [cecc2387-a89e-4f23-a528-e0faa372a655] Completed operation: chat-completion {
  requestId: 'cecc2387-a89e-4f23-a528-e0faa372a655',
  timestamp: '2025-02-28T17:51:48.399Z',
  userId: undefined,
  route: 'api/chat',
  duration: 1041,
  metadata: { status: 'success', duration: 1041, operation: 'chat-completion' }
}
Returning stream response to client
Stream response created successfully
 POST /api/chat 200 in 2329ms
 ✓ Compiled in 2.2s (2661 modules)
 GET /dashboard 200 in 277ms
 ○ Compiling /api/chat-context ...
 ✓ Compiled /api/chat-context in 565ms (1465 modules)

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
 GET /dashboard 200 in 852ms
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
 GET /api/chat-context 200 in 1206ms
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:56:32.931Z] [ERROR] [chat-context] [74d3d202-c051-4079-895d-14909467bcf8] Failed to fetch health score {
  requestId: '74d3d202-c051-4079-895d-14909467bcf8',
  timestamp: '2025-02-28T17:56:32.931Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 424,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:56:33.002Z] [INFO] [chat-context] [74d3d202-c051-4079-895d-14909467bcf8] Added survey data to chat context {
  requestId: '74d3d202-c051-4079-895d-14909467bcf8',
  timestamp: '2025-02-28T17:56:33.002Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 495,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:56:33.160Z] [INFO] [chat-context] [74d3d202-c051-4079-895d-14909467bcf8] Successfully generated chat context {
  requestId: '74d3d202-c051-4079-895d-14909467bcf8',
  timestamp: '2025-02-28T17:56:33.160Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 653,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:56:34.041Z] [ERROR] [chat-context] [6a1f690e-c5c5-4d3f-8970-481843d9e9ed] Failed to fetch health score {
  requestId: '6a1f690e-c5c5-4d3f-8970-481843d9e9ed',
  timestamp: '2025-02-28T17:56:34.041Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 287,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:56:34.111Z] [INFO] [chat-context] [6a1f690e-c5c5-4d3f-8970-481843d9e9ed] Added survey data to chat context {
  requestId: '6a1f690e-c5c5-4d3f-8970-481843d9e9ed',
  timestamp: '2025-02-28T17:56:34.111Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 357,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:56:34.284Z] [INFO] [chat-context] [6a1f690e-c5c5-4d3f-8970-481843d9e9ed] Successfully generated chat context {
  requestId: '6a1f690e-c5c5-4d3f-8970-481843d9e9ed',
  timestamp: '2025-02-28T17:56:34.284Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 530,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 575ms

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context
Requested report ID: not specified (will use latest)
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching latest lab report...

=== CHAT CONTEXT REQUEST ===
Request URL: http://localhost:3000/api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Requested report ID: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6
Request headers: [
  [
    "accept",
    "*/*"
  ],
  [
    "accept-encoding",
    "gzip, deflate, br, zstd"
  ],
  [
    "accept-language",
    "en-US,en;q=0.9"
  ],
  [
    "connection",
    "keep-alive"
  ],
  [
    "host",
    "localhost:3000"
  ],
  [
    "referer",
    "http://localhost:3000/dashboard"
  ],
  [
    "sec-ch-ua",
    "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
  ],
  [
    "sec-ch-ua-mobile",
    "?0"
  ],
  [
    "sec-ch-ua-platform",
    "\"macOS\""
  ],
  [
    "sec-fetch-dest",
    "empty"
  ],
  [
    "sec-fetch-mode",
    "cors"
  ],
  [
    "sec-fetch-site",
    "same-origin"
  ],
  [
    "user-agent",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
  ],
  [
    "x-forwarded-for",
    "::1"
  ],
  [
    "x-forwarded-host",
    "localhost:3000"
  ],
  [
    "x-forwarded-port",
    "3000"
  ],
  [
    "x-forwarded-proto",
    "http"
  ]
]
Creating Supabase client...
Supabase client created
Verifying session...
Session verified for user: 7a818aa4-a2dc-4693-82e0-16d1bef7a1f1
Fetching specified lab report...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Found 12 biomarkers
Fetching insights...
Found 0 insights
Fetching health score...
Found lab report: b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 from Uploaded Lab
Fetching biomarkers...
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:56:34.583Z] [ERROR] [chat-context] [674610d8-47b3-4dc0-944b-4cdc2910d088] Failed to fetch health score {
  requestId: '674610d8-47b3-4dc0-944b-4cdc2910d088',
  timestamp: '2025-02-28T17:56:34.583Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 285,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:56:34.640Z] [INFO] [chat-context] [674610d8-47b3-4dc0-944b-4cdc2910d088] Added survey data to chat context {
  requestId: '674610d8-47b3-4dc0-944b-4cdc2910d088',
  timestamp: '2025-02-28T17:56:34.640Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 342,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
Found 12 biomarkers
Fetching insights...
No previous reports found
Fetching previous reports for historical context...
Found 0 insights
Fetching health score...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:56:34.788Z] [INFO] [chat-context] [674610d8-47b3-4dc0-944b-4cdc2910d088] Successfully generated chat context {
  requestId: '674610d8-47b3-4dc0-944b-4cdc2910d088',
  timestamp: '2025-02-28T17:56:34.788Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 490,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context 200 in 502ms
Error fetching health score: {
  code: '42P01',
  details: null,
  hint: null,
  message: 'relation "public.health_scores" does not exist'
}
[2025-02-28T17:56:34.790Z] [ERROR] [chat-context] [fe5cdc33-38f9-4015-ba73-d7973cbd3b01] Failed to fetch health score {
  requestId: 'fe5cdc33-38f9-4015-ba73-d7973cbd3b01',
  timestamp: '2025-02-28T17:56:34.790Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 428,
  error: { message: '[object Object]', metadata: { rawError: [Object] } }
}
Health score: not available
Fetching latest health survey data...
Found health survey data from: 2/28/2025
[2025-02-28T17:56:34.848Z] [INFO] [chat-context] [fe5cdc33-38f9-4015-ba73-d7973cbd3b01] Added survey data to chat context {
  requestId: 'fe5cdc33-38f9-4015-ba73-d7973cbd3b01',
  timestamp: '2025-02-28T17:56:34.848Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 486,
  metadata: {
    surveyId: '3b7fc348-af30-47e0-8293-2291cdf236d9',
    surveyDate: 'February 28, 2025'
  }
}
Fetching previous reports for historical context...
No previous reports found
Fetching previous reports for historical context...
No previous reports found
Returning context with 12 biomarkers, 4 abnormal
[2025-02-28T17:56:34.978Z] [INFO] [chat-context] [fe5cdc33-38f9-4015-ba73-d7973cbd3b01] Successfully generated chat context {
  requestId: 'fe5cdc33-38f9-4015-ba73-d7973cbd3b01',
  timestamp: '2025-02-28T17:56:34.978Z',
  userId: '7a818aa4-a2dc-4693-82e0-16d1bef7a1f1',
  route: 'chat-context',
  duration: 616,
  metadata: {
    biomarkerCount: 12,
    abnormalCount: 4,
    hasHealthScore: false,
    reportId: 'b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6',
    hasPreviousReports: false
  }
}
 GET /api/chat-context?report_id=b3bfc4bb-bef3-4f15-a4ba-a3878dace2c6 200 in 628ms
 ⨯ components/chat-panel.tsx
Module not found: Can't resolve '../public/fonts/GildaDisplay-Regular.woff2'

https://nextjs.org/docs/messages/module-not-found

Import trace for requested module:
./node_modules/next/font/local/target.css?{"path":"components/chat-panel.tsx","import":"","arguments":[{"src":"../public/fonts/GildaDisplay-Regular.woff2","variable":"--font-gilda-display"}],"variableName":"gildaDisplay"}
./components/chat-panel.tsx
 ⨯ components/chat-panel.tsx
Module not found: Can't resolve '../public/fonts/Geist-Thin.woff2'

https://nextjs.org/docs/messages/module-not-found

Import trace for requested module:
./node_modules/next/font/local/target.css?{"path":"components/chat-panel.tsx","import":"","arguments":[{"src":"../public/fonts/Geist-Thin.woff2","variable":"--font-geist-thin"}],"variableName":"geistThin"}
./components/chat-panel.tsx
 ⨯ components/chat-panel.tsx
Module not found: Can't resolve '../public/fonts/Geist-Thin.woff2'

https://nextjs.org/docs/messages/module-not-found

Import trace for requested module:
./node_modules/next/font/local/target.css?{"path":"components/chat-panel.tsx","import":"","arguments":[{"src":"../public/fonts/Geist-Thin.woff2","variable":"--font-geist-thin"}],"variableName":"geistThin"}
./components/chat-panel.tsx
 ⨯ components/chat-panel.tsx
Module not found: Can't resolve '../public/fonts/Geist-Thin.woff2'

https://nextjs.org/docs/messages/module-not-found

Import trace for requested module:
./node_modules/next/font/local/target.css?{"path":"components/chat-panel.tsx","import":"","arguments":[{"src":"../public/fonts/Geist-Thin.woff2","variable":"--font-geist-thin"}],"variableName":"geistThin"}
./components/chat-panel.tsx
 ⨯ components/chat-panel.tsx
Module not found: Can't resolve '../public/fonts/Geist-Thin.woff2'

https://nextjs.org/docs/messages/module-not-found

Import trace for requested module:
./node_modules/next/font/local/target.css?{"path":"components/chat-panel.tsx","import":"","arguments":[{"src":"../public/fonts/Geist-Thin.woff2","variable":"--font-geist-thin"}],"variableName":"geistThin"}
./components/chat-panel.tsx
 ⨯ components/chat-panel.tsx
Module not found: Can't resolve '../public/fonts/Geist-Thin.woff2'

https://nextjs.org/docs/messages/module-not-found

Import trace for requested module:
./node_modules/next/font/local/target.css?{"path":"components/chat-panel.tsx","import":"","arguments":[{"src":"../public/fonts/Geist-Thin.woff2","variable":"--font-geist-thin"}],"variableName":"geistThin"}
./components/chat-panel.tsx
 ○ Compiling /_error ...
 ⨯ components/chat-panel.tsx
Module not found: Can't resolve '../public/fonts/Geist-Thin.woff2'

https://nextjs.org/docs/messages/module-not-found

Import trace for requested module:
./node_modules/next/font/local/target.css?{"path":"components/chat-panel.tsx","import":"","arguments":[{"src":"../public/fonts/Geist-Thin.woff2","variable":"--font-geist-thin"}],"variableName":"geistThin"}
./components/chat-panel.tsx
 GET /dashboard 500 in 3331ms
 ⨯ components/chat-panel.tsx
Module not found: Can't resolve '../public/fonts/Geist-Thin.woff2'

https://nextjs.org/docs/messages/module-not-found

Import trace for requested module:
./node_modules/next/font/local/target.css?{"path":"components/chat-panel.tsx","import":"","arguments":[{"src":"../public/fonts/Geist-Thin.woff2","variable":"--font-geist-thin"}],"variableName":"geistThin"}
./components/chat-panel.tsx
 GET /dashboard 500 in 46ms
 ⨯ components/chat-panel.tsx
Module not found: Can't resolve '../public/fonts/Geist-Thin.woff2'

https://nextjs.org/docs/messages/module-not-found

Import trace for requested module:
./node_modules/next/font/local/target.css?{"path":"components/chat-panel.tsx","import":"","arguments":[{"src":"../public/fonts/Geist-Thin.woff2","variable":"--font-geist-thin"}],"variableName":"geistThin"}
./components/chat-panel.tsx
